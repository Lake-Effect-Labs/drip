module.exports=[39495,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(52517);a.i(59193);var f=a.i(63561),g=a.i(41710),h=a.i(16201);function i({history:a}){return 0===a.length?(0,b.jsx)("div",{className:"p-4 text-center text-muted-foreground text-sm",children:"No history yet"}):(0,b.jsx)("div",{className:"space-y-4",children:a.map((c,d)=>(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:"done"===c.status||"paid"===c.status?(0,b.jsx)(h.CheckCircle,{className:"h-4 w-4 text-success"}):(0,b.jsx)(g.Clock,{className:"h-4 w-4 text-muted-foreground"})}),d<a.length-1&&(0,b.jsx)("div",{className:"w-0.5 h-full bg-border mt-2"})]}),(0,b.jsxs)("div",{className:"flex-1 pb-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"font-medium",children:f.JOB_STATUS_LABELS[c.status]||c.status}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:[(0,f.formatDate)(c.changed_at)," ",(0,f.formatTime)(new Date(c.changed_at).toISOString().split("T")[1].split(".")[0])]})]}),c.notes&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:c.notes})]})]},c.id))})}var j=a.i(96792),k=a.i(39177),l=a.i(63374),m=a.i(50838),n=a.i(65853),o=a.i(48351),p=a.i(20170),q=a.i(70106);let r=(0,q.default)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var s=a.i(92759),t=a.i(15618),u=a.i(81560),v=a.i(4720),w=a.i(92258);function x({open:a,onOpenChange:d,companyId:g,job:h,customer:i,invoices:q,scheduledDate:x,scheduledTime:y,address:z}){let[A,B]=(0,c.useState)([]),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(""),[I,J]=(0,c.useState)("sms"),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)(""),{addToast:O}=(0,p.useToast)(),P=(0,e.createClient)();async function Q(){D(!0);try{let{data:a,error:b}=await P.from("message_templates").select("*").eq("company_id",g).order("created_at",{ascending:!1});if(b)return void B([]);B(a||[])}catch(a){console.error("Error loading templates:",a),O("Failed to load templates","error")}finally{D(!1)}}function R(a){return a.replace(/\{\{customer_name\}\}/g,i?.name||"there").replace(/\{\{job_date\}\}/g,x?(0,f.formatDate)(x):"[date]").replace(/\{\{job_time\}\}/g,y?(0,f.formatTime)(y):"[time]").replace(/\{\{job_address\}\}/g,z||"[address]").replace(/\{\{amount\}\}/g,q[0]?(0,f.formatCurrency)(q[0].amount_total):"[amount]").replace(/\{\{invoice_link\}\}/g,q[0]?`/i/${q[0].public_token}`:"[invoice link]")}async function S(){if(!G.trim()||!M.trim())return void O("Please fill in all required fields","error");try{let a,{data:b,error:c}=await P.from("message_templates").insert({company_id:g,name:G.trim(),type:I,subject:"email"===I&&K.trim()?K.trim():null,body:M.trim(),variables:(a=(M+(K||"")).match(/\{\{(\w+)\}\}/g))?[...new Set(a.map(a=>a.replace(/\{\{|\}\}/g,"")))]:[]}).select().single();if(c)throw c;B(a=>[b,...a]),H(""),N(""),L(""),F(!1),O("Template saved!","success")}catch(a){console.error("Error saving template:",a),O("Failed to save template","error")}}async function T(a){try{let{error:b}=await P.from("message_templates").delete().eq("id",a);if(b)throw b;B(b=>b.filter(b=>b.id!==a)),O("Template deleted!","success")}catch(a){console.error("Error deleting template:",a),O("Failed to delete template","error")}}return(0,c.useEffect)(()=>{a&&Q()},[a,g]),(0,b.jsx)(j.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(j.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(j.DialogHeader,{children:[(0,b.jsx)(j.DialogTitle,{children:"Message Templates"}),(0,b.jsxs)(j.DialogDescription,{children:["Pre-written messages with variables. Use: ","{{customer_name}}",", ","{{job_date}}",", ","{{job_time}}",", ","{{job_address}}",", ","{{amount}}",", ","{{invoice_link}}"]})]}),(0,b.jsxs)("div",{className:"space-y-4 mt-4",children:[!E&&(0,b.jsxs)(k.Button,{onClick:()=>F(!0),className:"w-full",variant:"outline",children:[(0,b.jsx)(t.Plus,{className:"mr-2 h-4 w-4"}),"Create New Template"]}),E&&(0,b.jsxs)("div",{className:"rounded-lg border p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"templateName",children:"Template Name *"}),(0,b.jsx)(l.Input,{id:"templateName",value:G,onChange:a=>H(a.target.value),placeholder:"e.g., Job Scheduled"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"templateType",children:"Type *"}),(0,b.jsxs)(o.Select,{id:"templateType",value:I,onChange:a=>J(a.target.value),children:[(0,b.jsx)("option",{value:"sms",children:"SMS"}),(0,b.jsx)("option",{value:"email",children:"Email"})]})]})]}),"email"===I&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"templateSubject",children:"Subject"}),(0,b.jsx)(l.Input,{id:"templateSubject",value:K,onChange:a=>L(a.target.value),placeholder:"Email subject..."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"templateBody",children:"Message *"}),(0,b.jsx)(n.Textarea,{id:"templateBody",value:M,onChange:a=>N(a.target.value),placeholder:"Hey {{customer_name}} â€” just a reminder...",rows:4})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(k.Button,{onClick:S,disabled:!G.trim()||!M.trim(),children:"Save Template"}),(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>{F(!1),H(""),N(""),L("")},children:"Cancel"})]})]}),C?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading templates..."}):0===A.length?(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,b.jsx)(v.FileText,{className:"mx-auto h-8 w-8 mb-2 opacity-50"}),(0,b.jsx)("p",{children:"No templates yet"})]}):(0,b.jsx)("div",{className:"space-y-2",children:A.map(a=>{let c=R(a.body);return(0,b.jsxs)("div",{className:"rounded-lg border p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h4",{className:"font-medium",children:a.name}),(0,b.jsx)("span",{className:"text-xs px-2 py-0.5 rounded bg-muted",children:a.type.toUpperCase()})]}),"email"===a.type&&a.subject&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Subject: ",R(a.subject)]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-2 whitespace-pre-wrap",children:c})]}),(0,b.jsx)(k.Button,{size:"sm",variant:"ghost",onClick:()=>T(a.id),children:(0,b.jsx)(u.Trash2,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(k.Button,{size:"sm",variant:"outline",onClick:()=>{let b;return b=R(a.body),void((0,f.copyToClipboard)(b),O("Message copied!","success"))},className:"flex-1",children:[(0,b.jsx)(r,{className:"mr-2 h-4 w-4"}),"Copy"]}),(0,b.jsx)(k.Button,{size:"sm",onClick:()=>(function(a){let b=R(a.body);if("sms"===a.type&&i?.phone)window.location.href=`sms:${i.phone}?body=${encodeURIComponent(b)}`;else if("email"===a.type&&i?.email){let c=a.subject?R(a.subject):"Message from Drip";window.location.href=`mailto:${i.email}?subject=${encodeURIComponent(c)}&body=${encodeURIComponent(b)}`}else O(`No ${"sms"===a.type?"phone":"email"} available`,"error")})(a),className:"flex-1",disabled:"sms"===a.type&&!i?.phone||"email"===a.type&&!i?.email,children:"sms"===a.type?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(s.Send,{className:"mr-2 h-4 w-4"}),"Send SMS"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.Mail,{className:"mr-2 h-4 w-4"}),"Send Email"]})})]})]},a.id)})})]})]})})}var y=a.i(22243);let z=(0,q.default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function A({open:a,onOpenChange:d,mode:f,jobId:g,companyId:h,onRefresh:i}){let[o,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)([]),[t,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(""),[A,B]=(0,c.useState)(!0),[C,D]=(0,c.useState)(!0),[E,F]=(0,c.useState)(!1),{addToast:G}=(0,p.useToast)();async function H(){try{let a=await fetch("/api/job-templates");if(!a.ok)throw Error("Failed to load templates");let b=await a.json();s(b)}catch(a){console.error("Error loading templates:",a),G("Failed to load templates","error")}}async function I(){if(!t.trim())return void G("Please enter a template name","error");if(!g)return void G("No job selected","error");q(!0);try{let a=await fetch("/api/job-templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({job_id:g,name:t.trim(),description:w.trim()||null,include_notes:A,include_materials:C,include_estimate_structure:E})});if(!a.ok){let b=await a.json();throw Error(b.error||"Failed to save template")}G("Template saved successfully!","success"),v(""),x(""),B(!0),D(!0),F(!1),d(!1),i?.()}catch(a){console.error("Error saving template:",a),G(a.message||"Failed to save template","error")}finally{q(!1)}}async function J(a){if(confirm("Are you sure you want to delete this template?"))try{if(!(await fetch(`/api/job-templates/${a}`,{method:"DELETE"})).ok)throw Error("Failed to delete template");G("Template deleted","success"),H(),i?.()}catch(a){console.error("Error deleting template:",a),G("Failed to delete template","error")}}return(0,e.createClient)(),(0,c.useEffect)(()=>{a&&"manage"===f&&H()},[a,f]),(0,b.jsx)(j.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(j.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(j.DialogHeader,{children:[(0,b.jsx)(j.DialogTitle,{children:"save"===f?"Save as Template":"Manage Templates"}),(0,b.jsx)(j.DialogDescription,{children:"save"===f?"Create a reusable template from this job":`Manage your job templates (${r.length}/50)`})]}),"save"===f?(0,b.jsxs)("div",{className:"space-y-4 mt-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"templateName",children:"Template Name *"}),(0,b.jsx)(l.Input,{id:"templateName",placeholder:"e.g., Standard Interior Repaint",value:t,onChange:a=>v(a.target.value),autoFocus:!0,className:"min-h-[44px]"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"templateDescription",children:"Description (Optional)"}),(0,b.jsx)(n.Textarea,{id:"templateDescription",placeholder:"Add details about when to use this template...",value:w,onChange:a=>x(a.target.value),rows:3})]}),(0,b.jsxs)("div",{className:"rounded-lg border bg-muted/30 p-4 space-y-3",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"What to include:"}),(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(y.SimpleCheckbox,{id:"includeNotes",checked:A,onChange:a=>B(a.target.checked)}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(m.Label,{htmlFor:"includeNotes",className:"cursor-pointer font-normal",children:"Notes"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Copy job notes to template"})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(y.SimpleCheckbox,{id:"includeMaterials",checked:C,onChange:a=>D(a.target.checked)}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(m.Label,{htmlFor:"includeMaterials",className:"cursor-pointer font-normal",children:"Materials"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Save materials list for reuse"})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(y.SimpleCheckbox,{id:"includeEstimateStructure",checked:E,onChange:a=>F(a.target.checked)}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(m.Label,{htmlFor:"includeEstimateStructure",className:"cursor-pointer font-normal",children:"Estimate Structure"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Save line item names (prices not included)"})]})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>d(!1),disabled:o,children:"Cancel"}),(0,b.jsxs)(k.Button,{onClick:I,loading:o,children:[(0,b.jsx)(z,{className:"mr-2 h-4 w-4"}),"Save Template"]})]})]}):(0,b.jsx)("div",{className:"space-y-4 mt-4",children:0===r.length?(0,b.jsxs)("div",{className:"p-8 text-center text-muted-foreground",children:[(0,b.jsx)("p",{children:"No templates yet"}),(0,b.jsx)("p",{className:"text-sm mt-1",children:"Save your first template from a job detail page"})]}):(0,b.jsx)("div",{className:"space-y-3",children:r.map(a=>(0,b.jsx)("div",{className:"rounded-lg border bg-card p-4 space-y-2",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h4",{className:"font-medium",children:a.name}),a.description&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:a.description}),(0,b.jsxs)("div",{className:"flex gap-4 mt-2 text-xs text-muted-foreground",children:[a.template_materials&&(0,b.jsxs)("span",{children:[a.template_materials.length," materials"]}),a.template_estimate_items&&(0,b.jsxs)("span",{children:[a.template_estimate_items.length," estimate items"]}),a.notes&&(0,b.jsx)("span",{children:"Has notes"})]})]}),(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>J(a.id),className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:(0,b.jsx)(u.Trash2,{className:"h-4 w-4"})})]})},a.id))})})]})})}var B=a.i(38632);let C=(0,q.default)("image-plus",[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]]);function D({jobId:a,companyId:d,compact:e=!1}){let[f,g]=(0,c.useState)([]),[h,i]=(0,c.useState)(!0),[l,m]=(0,c.useState)(!1),[n,q]=(0,c.useState)(null),[r,s]=(0,c.useState)("other"),t=(0,c.useRef)(null),{addToast:v}=(0,p.useToast)();async function w(){try{let b=await fetch(`/api/jobs/${a}/photos`);if(!b.ok)throw Error("Failed to load photos");let c=await b.json();g(c)}catch(a){console.error("Error loading photos:",a),v("Failed to load photos","error")}finally{i(!1)}}async function x(a){let b=a.target.files?.[0];b&&(b.size>0xa00000?v("File too large (max 10MB)","error"):["image/jpeg","image/jpg","image/png","image/webp","image/heic"].includes(b.type)?await y(b):v("Invalid file type. Use JPEG, PNG, WebP, or HEIC","error"))}async function y(b){m(!0);try{let c=new FormData;c.append("file",b),c.append("tag",r);let d=await fetch(`/api/jobs/${a}/photos`,{method:"POST",body:c});if(!d.ok){let a=await d.json();throw console.error("Upload error details:",a),Error(a.error||"Upload failed")}let e=await d.json();g(a=>[e,...a]),v("Photo uploaded!","success"),t.current&&(t.current.value="")}catch(a){console.error("Upload error:",a),v(a.message||"Failed to upload photo","error")}finally{m(!1)}}async function z(b){if(confirm("Delete this photo? This cannot be undone."))try{if(!(await fetch(`/api/jobs/${a}/photos/${b}`,{method:"DELETE"})).ok)throw Error("Failed to delete photo");g(a=>a.filter(a=>a.id!==b)),q(null),v("Photo deleted","success")}catch(a){console.error("Delete error:",a),v("Failed to delete photo","error")}}return(0,c.useEffect)(()=>{w()},[a]),(0,b.jsxs)("div",{className:"space-y-4",children:[!e&&(0,b.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,b.jsx)("input",{ref:t,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp,image/heic",onChange:x,className:"hidden"}),(0,b.jsxs)(o.Select,{value:r,onChange:a=>s(a.target.value),className:"flex-1 min-h-[44px]",children:[(0,b.jsx)("option",{value:"before",children:"Before"}),(0,b.jsx)("option",{value:"after",children:"After"}),(0,b.jsx)("option",{value:"other",children:"Other"})]}),(0,b.jsxs)(k.Button,{onClick:()=>t.current?.click(),disabled:l,loading:l,className:"flex-1 touch-target min-h-[44px]",children:[(0,b.jsx)(C,{className:"mr-2 h-4 w-4"}),l?"Uploading...":"Add Photo"]})]}),h&&(0,b.jsxs)("div",{className:"p-8 text-center text-muted-foreground",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-sm",children:"Loading photos..."})]}),!h&&0===f.length&&(0,b.jsxs)("div",{className:"p-8 text-center text-muted-foreground rounded-lg border bg-muted/30",children:[(0,b.jsx)(B.Image,{className:"mx-auto h-8 w-8 mb-2"}),(0,b.jsx)("p",{children:"No photos yet"}),(0,b.jsx)("p",{className:"text-xs mt-1",children:"Take or upload photos to document this job"})]}),!h&&f.length>0&&(0,b.jsx)("div",{className:e?"flex items-center gap-2":"grid grid-cols-2 sm:grid-cols-3 gap-3",children:e?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[(0,b.jsx)(B.Image,{className:"h-4 w-4"}),(0,b.jsxs)("span",{children:[f.length," photo",1!==f.length?"s":""]})]}),f.slice(0,3).map(a=>(0,b.jsx)("button",{onClick:()=>q(a),className:"w-12 h-12 rounded overflow-hidden bg-muted hover:opacity-80 transition-opacity",children:(0,b.jsx)("img",{src:a.public_url,alt:a.caption||"Photo",className:"w-full h-full object-cover"})},a.id))]}):f.map(a=>(0,b.jsxs)("button",{onClick:()=>q(a),className:"aspect-square rounded-lg overflow-hidden bg-muted hover:opacity-80 transition-opacity relative",children:[(0,b.jsx)("img",{src:a.public_url,alt:a.caption||"Photo",className:"w-full h-full object-cover"}),a.tag&&(0,b.jsx)("span",{className:"absolute top-2 left-2 text-xs bg-black/60 text-white px-2 py-1 rounded",children:a.tag})]},a.id))}),(0,b.jsx)(j.Dialog,{open:!!n,onOpenChange:a=>!a&&q(null),children:(0,b.jsxs)(j.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Photo"})}),n&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("img",{src:n.public_url,alt:n.caption||"Photo",className:"w-full rounded-lg"}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground space-y-1",children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Tag:"})," ",n.tag||"other"]}),n.file_name&&(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"File:"})," ",n.file_name]}),n.caption&&(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Caption:"})," ",n.caption]})]}),(0,b.jsxs)(k.Button,{variant:"destructive",size:"sm",onClick:()=>z(n.id),children:[(0,b.jsx)(u.Trash2,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})})]})}var E=a.i(85158);let F=(0,q.default)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var G=a.i(33441),H=a.i(90166);let I=(0,q.default)("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);var J=a.i(99464);function K({jobId:a,companyId:g,customerId:h,paymentState:i,paymentAmount:q,paymentApprovedAt:s,paymentPaidAt:v,paymentMethod:w,publicToken:x,lineItems:y,estimatingConfig:z,estimateStatus:A,estimateDeniedAt:B,estimateDenialReason:C,onUpdate:D}){let K=(0,e.createClient)(),{addToast:L}=(0,p.useToast)();(0,d.useRouter)();let[M,N]=(0,c.useState)(i),[O,P]=(0,c.useState)(v),[Q,R]=(0,c.useState)(w);(0,c.useEffect)(()=>{N(i)},[i]),(0,c.useEffect)(()=>{P(v)},[v]),(0,c.useEffect)(()=>{R(w)},[w]);let[S,T]=(0,c.useState)(y.length>0?y.map(a=>({id:a.id,type:"other",title:a.title,price:(a.price/100).toFixed(2),paintBrand:"",paintColor:"",paintSheen:"",paintQuantity:"",paintQuantityUnit:"gal"})):[{type:"other",title:"",price:"",paintBrand:"",paintColor:"",paintSheen:"",paintQuantity:"",paintQuantityUnit:"gal"}]),[U,V]=(0,c.useState)(!1),[W,X]=(0,c.useState)(!1),[Y,Z]=(0,c.useState)("cash"),[$,_]=(0,c.useState)(!1),[aa,ab]=(0,c.useState)(!1),[ac,ad]=(0,c.useState)(!1),[ae,af]=(0,c.useState)(!1),[ag,ah]=(0,c.useState)(["cash","check","venmo","stripe"]),[ai,aj]=(0,c.useState)(x),[ak,al]=(0,c.useState)(),[am,an]=(0,c.useState)(!1),[ao,ap]=(0,c.useState)(!1);async function aq(){ab(!0);try{let{data:b}=await K.from("estimates").select("id").eq("job_id",a).maybeSingle();if(!b)return void ab(!1);let{data:c}=await K.from("estimate_line_items").select("*").eq("estimate_id",b.id).order("created_at",{ascending:!0});if(c&&c.length>0){let a=c.map(a=>{let b,c="other";if("sqft"===a.service_type){c="area";let d=a.name.toLowerCase();b=d.includes("exterior")&&d.includes("walls")?"exterior_walls":d.includes("exterior")&&d.includes("trim")?"exterior_trim":d.includes("deck")||d.includes("fence")?"deck_fence":d.includes("siding")?"siding":d.includes("walls")?"walls":d.includes("ceiling")?"ceilings":d.includes("trim")?"trim":d.includes("door")?"doors":"other"}return{id:a.id,type:c,title:a.name,price:(a.price/100).toFixed(2),areaType:b,sqft:a.sqft?.toString()||"",ratePerSqft:a.rate_per_sqft?.toString()||"",paintBrand:a.product_line||"",paintColor:a.paint_color_name_or_code||"",paintSheen:a.sheen||"",paintQuantity:a.gallons_estimate?.toString()||"",paintQuantityUnit:"gal"}});T(a)}}catch(a){console.error("Error loading estimate:",a),L("Failed to load estimate details","error")}finally{ab(!1)}}async function ar(){if(ai||x)return ai||x;an(!0);try{let b,c,d=(0,f.generateToken)(24),{data:e}=await K.from("estimates").select("id, public_token").eq("job_id",a).maybeSingle();if(e){let{data:a,error:f}=await K.from("estimates").update({public_token:d,status:"sent",customer_id:h,updated_at:new Date().toISOString()}).eq("id",e.id).select("public_token").single();b=a,c=f}else{let{data:e,error:f}=await K.from("estimates").insert({company_id:g,job_id:a,customer_id:h,status:"sent",public_token:d}).select("public_token").single();b=e,c=f}if(c)return console.error("Estimate create/update error:",c),aj(d),d;if(b)return aj(b.public_token),b.public_token}catch(b){console.error("Error ensuring public token:",b);let a=(0,f.generateToken)(24);return aj(a),a}finally{an(!1)}}(0,c.useEffect)(()=>{!async function(){if(!ai&&a&&"proposed"===i){an(!0);try{let{data:b}=await K.from("estimates").select("public_token").eq("job_id",a).maybeSingle();b?.public_token&&aj(b.public_token)}catch(a){console.error("Error fetching estimate token:",a)}finally{an(!1)}}}()},[a,i,ai,K]),(0,c.useEffect)(()=>{!async function(){if(!ak&&a&&"due"===i){ap(!0);try{let{data:b}=await K.from("jobs").select("payment_token").eq("id",a).single();b?.payment_token&&al(b.payment_token)}catch(a){console.error("Error fetching payment token:",a)}finally{ap(!1)}}}()},[a,i,ak,K]);let as=S.reduce((a,b)=>"area"===b.type&&b.ratePerSqft&&b.sqft?a+Math.round((parseFloat(b.ratePerSqft)||0)*(parseFloat(b.sqft)||0)*100):"labor"===b.type&&b.hours&&b.ratePerHour?a+Math.round((parseFloat(b.hours)||0)*(parseFloat(b.ratePerHour)||0)*100):a+Math.round(100*(parseFloat(b.price)||0)),0),at=(a,b,c)=>{let d=[...S];d[a][b]=c,"type"===b&&("area"===c?(d[a].areaType="walls",d[a].ratePerSqft=z?.walls_rate_per_sqft?.toString()||"",d[a].sqft=""):"labor"===c&&(d[a].hours="",d[a].ratePerHour=z?.labor_rate_per_hour?.toString()||""),d[a].price=""),"areaType"===b&&"walls"===c?d[a].ratePerSqft=z?.walls_rate_per_sqft?.toString()||"":"areaType"===b&&"ceilings"===c?d[a].ratePerSqft=z?.ceilings_rate_per_sqft?.toString()||"":"areaType"===b&&("trim"===c||"doors"===c)&&(d[a].ratePerSqft=z?.trim_rate_per_sqft?.toString()||""),T(d)};async function au(){if(!S.some(a=>"area"===a.type?a.ratePerSqft&&a.sqft&&parseFloat(a.ratePerSqft)>0&&parseFloat(a.sqft)>0:"labor"===a.type?a.hours&&a.ratePerHour&&parseFloat(a.hours)>0&&parseFloat(a.ratePerHour)>0:a.title.trim()&&a.price.trim()&&parseFloat(a.price)>0))return void L("Please add at least one complete line item","error");V(!0);try{let b,c,d,e={payment_state:"proposed",payment_amount:as};"approved"===M&&(e.payment_approved_at=null);let{error:i}=await K.from("jobs").update(e).eq("id",a);if(i)throw console.error("Job update error:",i),i;N("proposed");let{error:j}=await K.from("job_payment_line_items").delete().eq("job_id",a);if(j)throw console.error("Delete line items error:",j),j;let k=S.filter(a=>"area"===a.type?a.ratePerSqft&&a.sqft&&parseFloat(a.ratePerSqft)>0&&parseFloat(a.sqft)>0:"labor"===a.type?a.hours&&a.ratePerHour&&parseFloat(a.hours)>0&&parseFloat(a.ratePerHour)>0:a.title.trim()&&a.price.trim()&&parseFloat(a.price)>0).map((b,c)=>{let d="",e=0;return"area"===b.type&&b.areaType&&b.ratePerSqft&&b.sqft?(d=`${({walls:"Interior Walls",ceilings:"Ceilings",trim:"Interior Trim",doors:"Doors",exterior_walls:"Exterior Walls",exterior_trim:"Exterior Trim",deck_fence:"Deck/Fence",siding:"Siding",other:"Other"})[b.areaType]} - ${b.sqft} sqft @ $${b.ratePerSqft}/sqft`,e=Math.round((parseFloat(b.ratePerSqft)||0)*(parseFloat(b.sqft)||0)*100)):"labor"===b.type&&b.hours&&b.ratePerHour?(d=`Labor - ${b.hours} hrs @ $${b.ratePerHour}/hr`,e=Math.round((parseFloat(b.hours)||0)*(parseFloat(b.ratePerHour)||0)*100)):(d=b.title.trim(),e=Math.round(100*(parseFloat(b.price)||0))),{job_id:a,title:d,price:e,sort_order:c}});if(0===k.length)throw Error("No valid line items to save");let{error:l}=await K.from("job_payment_line_items").insert(k);if(l)throw console.error("Items insert error:",l),l;let m=ai||(0,f.generateToken)(24),{data:n}=await K.from("estimates").select("id, public_token").eq("job_id",a).maybeSingle();if(n){let{data:a,error:e}=await K.from("estimates").update({public_token:m,status:"sent",customer_id:h,accepted_at:null,updated_at:new Date().toISOString()}).eq("id",n.id).select("id, public_token").single();c=a,d=e,b=n.id}else{let{data:e,error:f}=await K.from("estimates").insert({company_id:g,job_id:a,customer_id:h,status:"sent",public_token:m}).select("id, public_token").single();c=e,d=f,b=e?.id||""}if(d)console.error("Estimate create/update error:",d);else if(c&&b){aj(c.public_token),await K.from("estimate_line_items").delete().eq("estimate_id",b);let a=S.filter(a=>"area"===a.type?a.ratePerSqft&&a.sqft&&parseFloat(a.ratePerSqft)>0&&parseFloat(a.sqft)>0:"labor"===a.type?a.hours&&a.ratePerHour&&parseFloat(a.hours)>0&&parseFloat(a.ratePerHour)>0:a.title.trim()&&a.price.trim()&&parseFloat(a.price)>0).map(a=>{let c="",d=0,e="flat";return"area"===a.type&&a.areaType&&a.ratePerSqft&&a.sqft?(c=({walls:"Interior Walls",ceilings:"Ceilings",trim:"Interior Trim",doors:"Doors",exterior_walls:"Exterior Walls",exterior_trim:"Exterior Trim",deck_fence:"Deck/Fence",siding:"Siding",other:"Other"})[a.areaType],d=Math.round((parseFloat(a.ratePerSqft)||0)*(parseFloat(a.sqft)||0)*100),e="sqft"):"labor"===a.type&&a.hours&&a.ratePerHour?(c="Labor",d=Math.round((parseFloat(a.hours)||0)*(parseFloat(a.ratePerHour)||0)*100)):(c=a.title.trim(),d=Math.round(100*(parseFloat(a.price)||0))),{estimate_id:b,service_key:"other",service_type:e,name:c,description:null,price:d,sqft:"area"===a.type&&a.sqft?parseFloat(a.sqft):null,rate_per_sqft:"area"===a.type&&a.ratePerSqft?parseFloat(a.ratePerSqft):null,paint_color_name_or_code:a.paintColor||null,sheen:a.paintSheen||null,product_line:a.paintBrand||null,gallons_estimate:a.paintQuantity?parseFloat(a.paintQuantity):null}});if(a.length>0){await K.from("estimate_line_items").insert(a);try{await fetch(`/api/estimate-materials/${b}/generate`,{method:"POST"})}catch(a){console.error("Failed to auto-generate materials:",a)}}}"approved"===M?(L("Estimate revised - customer needs to approve again","success"),N("proposed")):L("Estimate saved","success"),_(!1),setTimeout(()=>D(),100)}catch(b){console.error("Failed to save payment:",b),console.error("Error details:",{message:b?.message,code:b?.code,details:b?.details,hint:b?.hint,fullError:b});let a=b?.message||b?.code||b?.details||JSON.stringify(b)||"Unknown error";L(`Failed to save: ${a}`,"error")}finally{V(!1)}}async function av(){let a=await ar();if(!a)return void L("Unable to generate link","error");let b=`${window.location.origin}/e/${a}`;(0,f.copyToClipboard)(b),L("Estimate link copied to clipboard","success"),ad(!1)}async function aw(){let a=await ar();if(!a)return void L("Unable to generate link","error");let b=`${window.location.origin}/e/${a}`,c=`Hey there â€” here's your estimate for ${(0,f.formatCurrency)(q||as)}: ${b}. Let me know if you have any questions!`;(0,f.copyToClipboard)(c),L("Message copied to clipboard","success"),ad(!1)}async function ax(){V(!0);try{let{error:b}=await K.from("jobs").update({payment_state:"approved",payment_approved_at:new Date().toISOString()}).eq("id",a);if(b)throw b;N("approved"),L("Price approved! ðŸŽ‰","success"),D()}catch(a){console.error("Failed to approve:",a),L("Failed to approve","error")}finally{V(!1)}}async function ay(){if(ak)return ak;ap(!0);try{let{data:b}=await K.from("jobs").select("payment_token").eq("id",a).single();if(b?.payment_token)return al(b.payment_token),b.payment_token;let c=(0,f.generateToken)(24),{error:d}=await K.from("jobs").update({payment_token:c}).eq("id",a);if(d)throw d;return al(c),c}catch(a){return console.error("Failed to generate payment token:",a),L("Failed to generate payment link","error"),null}finally{ap(!1)}}async function az(){let b=ag.length>0?ag:["cash","check","venmo","stripe"];V(!0);try{let c=await ay();if(!c)return void V(!1);let{error:d}=await K.from("jobs").update({payment_state:"due",payment_token:c,payment_methods:b}).eq("id",a);if(d)throw d;N("due"),L("Payment requested","success"),D()}catch(a){console.error("Failed to mark due:",a),L("Failed to request payment","error")}finally{V(!1)}}async function aA(){V(!0);try{let{error:b}=await K.from("jobs").update({payment_state:"paid",payment_paid_at:new Date().toISOString(),payment_method:Y,status:"paid",updated_at:new Date().toISOString()}).eq("id",a);if(b)throw b;let c=new Date().toISOString();N("paid"),P(c),R(Y),L("Payment recorded! ðŸ’°","success"),X(!1),D()}catch(a){console.error("Failed to mark paid:",a),L("Failed to record payment","error")}finally{V(!1)}}return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.Dialog,{open:ac,onOpenChange:async a=>{ad(a),a&&await ar()},children:(0,b.jsxs)(j.DialogContent,{className:"max-w-lg",children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Share Estimate"})}),(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-sm text-muted-foreground",children:"Estimate Link"}),(0,b.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,b.jsx)(l.Input,{value:am?"Generating...":"No token available",readOnly:!0,className:"font-mono text-sm"}),(0,b.jsx)(k.Button,{variant:"outline",onClick:av,disabled:am,className:"shrink-0",children:(0,b.jsx)(r,{className:"h-4 w-4"})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-sm text-muted-foreground",children:"Pre-written Message"}),(0,b.jsx)(n.Textarea,{value:am?"Generating link...":`Hey there â€” here's your estimate for ${(0,f.formatCurrency)(q||as)}: [link will be generated]. Let me know if you have any questions!`,readOnly:!0,rows:4,className:"mt-2 font-sans"}),(0,b.jsxs)(k.Button,{onClick:aw,className:"w-full mt-2",disabled:am,children:[(0,b.jsx)(r,{className:"mr-2 h-4 w-4"}),"Copy Message"]})]})]})})]})}),(0,b.jsx)(j.Dialog,{open:ae,onOpenChange:async a=>{af(a),a&&await ay()},children:(0,b.jsxs)(j.DialogContent,{className:"max-w-lg",children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Share Payment"})}),(0,b.jsx)("div",{className:"space-y-4",children:ao?(0,b.jsx)("div",{className:"text-center py-4",children:(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Generating link..."})}):ak?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-4",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Amount Due"}),(0,b.jsx)("p",{className:"font-semibold text-lg",children:(0,f.formatCurrency)(q||0)})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-sm text-muted-foreground",children:"Payment Link"}),(0,b.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,b.jsx)(l.Input,{value:"",readOnly:!0,className:"font-mono text-sm"}),(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>{let a=`${window.location.origin}/p/${ak}`;(0,f.copyToClipboard)(a),L("Payment link copied","success")},disabled:ao,className:"shrink-0",children:(0,b.jsx)(r,{className:"h-4 w-4"})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-sm text-muted-foreground",children:"Pre-written Message"}),(0,b.jsx)(n.Textarea,{value:`Hey there â€” here's your invoice for ${(0,f.formatCurrency)(q||0)}: [link will be generated]. Thank you!`,readOnly:!0,rows:4,className:"mt-2 font-sans"}),(0,b.jsxs)(k.Button,{onClick:()=>{let a=`${window.location.origin}/p/${ak}`,b=`Hey there â€” here's your invoice for ${(0,f.formatCurrency)(q||0)}: ${a}. Thank you!`;(0,f.copyToClipboard)(b),L("Message copied to clipboard","success"),af(!1)},className:"w-full mt-2",disabled:ao,children:[(0,b.jsx)(r,{className:"mr-2 h-4 w-4"}),"Copy Message"]})]})]})]}):(0,b.jsx)("div",{className:"text-center py-4",children:(0,b.jsx)("p",{className:"text-sm text-destructive",children:"No token available"})})})]})}),(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-4 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("h3",{className:"font-semibold",children:(()=>{switch(i){case"none":case"proposed":return"Estimate";case"approved":return"Agreed Price";case"due":return"Payment Due";case"paid":return"Paid";default:return"Payment"}})()}),"none"!==i&&(0,b.jsx)(E.Badge,{variant:(()=>{switch(i){case"proposed":return"secondary";case"approved":return"default";case"due":return"warning";case"paid":return"success";default:return"outline"}})(),children:i.charAt(0).toUpperCase()+i.slice(1)}),"denied"===A&&(0,b.jsx)(E.Badge,{variant:"destructive",children:"Denied"})]}),q&&(0,b.jsx)("div",{className:"text-xl font-bold",children:(0,f.formatCurrency)(q)})]}),"denied"===A&&(0,b.jsx)("div",{className:"rounded-lg border-2 border-destructive bg-destructive/10 p-4 space-y-3",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"w-6 h-6 rounded-full bg-destructive text-white flex items-center justify-center shrink-0 mt-0.5",children:"âœ—"}),(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-semibold text-destructive",children:"Customer Declined Estimate"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Declined on ",(0,f.formatDate)(B||new Date().toISOString())]})]}),C&&(0,b.jsxs)("div",{className:"bg-card p-3 rounded-lg border",children:[(0,b.jsx)("p",{className:"text-sm font-medium mb-1",children:"Customer Feedback:"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:C})]}),(0,b.jsx)("div",{className:"flex gap-2 pt-2",children:(0,b.jsxs)(k.Button,{variant:"outline",size:"sm",onClick:async()=>{await aq(),_(!0)},disabled:aa,children:[(0,b.jsx)(F,{className:"h-4 w-4 mr-2"}),aa?"Loading...":"Revise Estimate"]})}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Review the customer's feedback and revise the estimate. You can adjust pricing, scope, or send a message to discuss their concerns."})]})]})}),("none"===M||"proposed"===M||"approved"===M&&$)&&(0,b.jsx)("div",{className:"space-y-4",children:"proposed"===M&&y.length>0&&!$?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"rounded-lg border bg-muted/30 p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h4",{className:"font-medium text-sm",children:"Estimate Total"}),(0,b.jsx)("span",{className:"text-lg font-bold",children:(0,f.formatCurrency)(q||as)})]}),(0,b.jsx)("div",{className:"space-y-1",children:y.map(a=>(0,b.jsxs)("div",{className:"flex justify-between text-sm text-muted-foreground",children:[(0,b.jsx)("span",{children:a.title}),(0,b.jsx)("span",{children:(0,f.formatCurrency)(a.price)})]},a.id))})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(k.Button,{variant:"outline",onClick:async()=>{await ar(),ad(!0)},className:"flex-1",children:[(0,b.jsx)(I,{className:"mr-2 h-4 w-4"}),"Share Estimate"]}),(0,b.jsxs)(k.Button,{variant:"outline",onClick:async()=>{await aq(),_(!0)},disabled:aa,className:"flex-1",children:[(0,b.jsx)(J.Pencil,{className:"mr-2 h-4 w-4"}),aa?"Loading...":"Edit"]}),h&&(0,b.jsxs)(k.Button,{variant:"default",onClick:ax,loading:U,className:"flex-1",children:[(0,b.jsx)(G.Check,{className:"mr-2 h-4 w-4"}),"Approve"]})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"rounded-lg border bg-muted/30 p-4 space-y-4",children:[S.map((a,c)=>{let d="area"===a.type&&a.ratePerSqft&&a.sqft?(parseFloat(a.ratePerSqft)||0)*(parseFloat(a.sqft)||0):"labor"===a.type&&a.hours&&a.ratePerHour?(parseFloat(a.hours)||0)*(parseFloat(a.ratePerHour)||0):parseFloat(a.price)||0;return(0,b.jsxs)("div",{className:"p-3 sm:p-4 rounded-lg border bg-card space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsxs)(o.Select,{value:a.type,onChange:a=>at(c,"type",a.target.value),className:"flex-1 min-h-[44px]",children:[(0,b.jsx)("option",{value:"area",children:"Area"}),(0,b.jsx)("option",{value:"labor",children:"Labor"}),(0,b.jsx)("option",{value:"other",children:"Other"})]}),S.length>1&&(0,b.jsx)("button",{onClick:()=>{1!==S.length&&T(S.filter((a,b)=>b!==c))},className:"text-muted-foreground hover:text-destructive min-h-[44px] w-11 flex items-center justify-center shrink-0 touch-target","aria-label":"Remove line item",children:(0,b.jsx)(u.Trash2,{className:"h-5 w-5"})})]}),"area"===a.type?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-xs text-muted-foreground mb-1",children:"Area Type"}),(0,b.jsxs)(o.Select,{value:a.areaType||"walls",onChange:a=>at(c,"areaType",a.target.value),className:"w-full min-h-[44px]",children:[(0,b.jsxs)("optgroup",{label:"Interior",children:[(0,b.jsx)("option",{value:"walls",children:"Interior Walls"}),(0,b.jsx)("option",{value:"ceilings",children:"Ceilings"}),(0,b.jsx)("option",{value:"trim",children:"Interior Trim"}),(0,b.jsx)("option",{value:"doors",children:"Doors"})]}),(0,b.jsxs)("optgroup",{label:"Exterior",children:[(0,b.jsx)("option",{value:"exterior_walls",children:"Exterior Walls"}),(0,b.jsx)("option",{value:"exterior_trim",children:"Exterior Trim"}),(0,b.jsx)("option",{value:"deck_fence",children:"Deck/Fence"}),(0,b.jsx)("option",{value:"siding",children:"Siding"})]}),(0,b.jsx)("option",{value:"other",children:"Other"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-xs text-muted-foreground mb-1",children:"Square Feet"}),(0,b.jsx)(l.Input,{type:"number",step:"0.01",min:"0",placeholder:"0",value:a.sqft||"",onChange:a=>at(c,"sqft",a.target.value),className:"min-h-[44px]"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-xs text-muted-foreground mb-1",children:"Rate ($/sqft)"}),(0,b.jsx)(l.Input,{type:"number",step:"0.01",min:"0",placeholder:"0.00",value:a.ratePerSqft||"",onChange:a=>at(c,"ratePerSqft",a.target.value),className:"min-h-[44px]"})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Total"}),(0,b.jsx)("span",{className:"text-lg font-bold",children:(0,f.formatCurrency)(Math.round(100*d))})]}),(0,b.jsxs)("div",{className:"pt-3 border-t space-y-3",children:[(0,b.jsx)(m.Label,{className:"text-xs font-semibold",children:"Paint Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{className:"text-xs text-muted-foreground",children:"Brand"}),(0,b.jsxs)(o.Select,{value:a.paintBrand||"",onChange:a=>at(c,"paintBrand",a.target.value),className:"min-h-[44px]",children:[(0,b.jsx)("option",{value:"",children:"Select brand..."}),(0,b.jsx)("option",{value:"Sherwin-Williams",children:"Sherwin-Williams"}),(0,b.jsx)("option",{value:"Benjamin Moore",children:"Benjamin Moore"}),(0,b.jsx)("option",{value:"Behr",children:"Behr"}),(0,b.jsx)("option",{value:"PPG",children:"PPG"}),(0,b.jsx)("option",{value:"Other",children:"Other"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{className:"text-xs text-muted-foreground",children:"Color"}),(0,b.jsx)(l.Input,{placeholder:"e.g., SW 7008 Alabaster",value:a.paintColor||"",onChange:a=>at(c,"paintColor",a.target.value),className:"min-h-[44px]"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{className:"text-xs text-muted-foreground",children:"Sheen"}),(0,b.jsxs)(o.Select,{value:a.paintSheen||"",onChange:a=>at(c,"paintSheen",a.target.value),className:"min-h-[44px]",children:[(0,b.jsx)("option",{value:"",children:"Select sheen..."}),(0,b.jsx)("option",{value:"Flat",children:"Flat"}),(0,b.jsx)("option",{value:"Matte",children:"Matte"}),(0,b.jsx)("option",{value:"Eggshell",children:"Eggshell"}),(0,b.jsx)("option",{value:"Satin",children:"Satin"}),(0,b.jsx)("option",{value:"Semi-Gloss",children:"Semi-Gloss"}),(0,b.jsx)("option",{value:"Gloss",children:"Gloss"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{className:"text-xs text-muted-foreground",children:"Quantity"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(l.Input,{type:"number",min:"0",step:"0.25",placeholder:"e.g., 3",value:a.paintQuantity||"",onChange:a=>at(c,"paintQuantity",a.target.value),className:"min-h-[44px] flex-1"}),(0,b.jsxs)(o.Select,{value:a.paintQuantityUnit||"gal",onChange:a=>at(c,"paintQuantityUnit",a.target.value),className:"min-h-[44px] w-28",children:[(0,b.jsx)("option",{value:"gal",children:"Gallons"}),(0,b.jsx)("option",{value:"qt",children:"Quarts"}),(0,b.jsx)("option",{value:"pt",children:"Pints"}),(0,b.jsx)("option",{value:"oz",children:"Oz"})]})]})]})]})]})]}):"labor"===a.type?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-xs text-muted-foreground mb-1",children:"Hours"}),(0,b.jsx)(l.Input,{type:"number",step:"0.25",min:"0",placeholder:"0",value:a.hours||"",onChange:a=>at(c,"hours",a.target.value),className:"min-h-[44px]"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-xs text-muted-foreground mb-1",children:"Rate ($/hr)"}),(0,b.jsx)(l.Input,{type:"number",step:"0.01",min:"0",placeholder:"0.00",value:a.ratePerHour||"",onChange:a=>at(c,"ratePerHour",a.target.value),className:"min-h-[44px]"})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Total"}),(0,b.jsx)("span",{className:"text-lg font-bold",children:(0,f.formatCurrency)(Math.round(100*d))})]})]}):(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-xs text-muted-foreground mb-1",children:"Description"}),(0,b.jsx)(l.Input,{placeholder:"e.g., Materials, Travel, etc.",value:a.title,onChange:a=>at(c,"title",a.target.value),className:"w-full min-h-[44px]"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-xs text-muted-foreground mb-1",children:"Amount"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:"$"}),(0,b.jsx)(l.Input,{type:"number",step:"0.01",min:"0.01",placeholder:"0.00",value:a.price,onChange:a=>at(c,"price",a.target.value),className:"pl-7 min-h-[44px]"})]})]})]})]},c)}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(k.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{T([...S,{type:"other",title:"",price:"",paintBrand:"",paintColor:"",paintSheen:"",paintQuantity:"",paintQuantityUnit:"gal"}])},className:"flex-1 touch-target min-h-[44px]",children:[(0,b.jsx)(t.Plus,{className:"mr-2 h-4 w-4"}),"Add Line"]}),(0,b.jsx)(k.Button,{onClick:au,loading:U,disabled:S.every(a=>"area"===a.type?!a.ratePerSqft||!a.sqft||0>=parseFloat(a.ratePerSqft||"0")||0>=parseFloat(a.sqft||"0"):"labor"===a.type?!a.hours||!a.ratePerHour||0>=parseFloat(a.hours||"0")||0>=parseFloat(a.ratePerHour||"0"):!a.title.trim()||!a.price.trim()||0>=parseFloat(a.price)),className:"flex-1 touch-target min-h-[44px]",children:"proposed"===M||"approved"===M&&$?"Update Estimate":"Create Estimate"})]})]}),$&&(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>{_(!1),T(y.length>0?y.map(a=>({id:a.id,type:"other",title:a.title,price:(a.price/100).toFixed(2)})):[{type:"other",title:"",price:""}])},className:"flex-1",children:"Cancel"})})]})}),"approved"===M&&!$&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"rounded-lg border bg-success/10 border-success/20 p-4",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-success mb-2",children:"âœ“ Thanks for approving!"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Price is locked at ",(0,f.formatCurrency)(q||0)]}),s&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Approved ",(0,f.formatDate)(s)]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(k.Button,{variant:"outline",onClick:async()=>{await aq(),_(!0)},disabled:aa,className:"flex-1",children:[(0,b.jsx)(F,{className:"mr-2 h-4 w-4"}),aa?"Loading...":"Revise Estimate"]}),(0,b.jsxs)(k.Button,{onClick:az,loading:U,className:"flex-1",children:[(0,b.jsx)(H.DollarSign,{className:"mr-2 h-4 w-4"}),"Finalize Payment"]})]})]}),"due"===M&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"rounded-lg border bg-warning/10 border-warning/20 p-4",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-foreground mb-2",children:"ðŸ’° Payment Requested"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Amount due: ",(0,f.formatCurrency)(q||0)]})]}),(0,b.jsx)("div",{className:"space-y-2",children:y.map(a=>(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{children:a.title}),(0,b.jsx)("span",{className:"font-medium",children:(0,f.formatCurrency)(a.price)})]},a.id))}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(k.Button,{variant:"outline",onClick:async()=>{await ay(),af(!0)},className:"flex-1",children:[(0,b.jsx)(I,{className:"mr-2 h-4 w-4"}),"Share Payment"]}),(0,b.jsxs)(k.Button,{onClick:()=>X(!0),className:"flex-1",children:[(0,b.jsx)(G.Check,{className:"mr-2 h-4 w-4"}),"Mark as Paid"]})]})]}),"paid"===M&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"rounded-lg border bg-success/10 border-success/20 p-4",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-success mb-2",children:"âœ“ Payment Received"}),(0,b.jsxs)("div",{className:"space-y-1 text-sm text-muted-foreground",children:[O&&(0,b.jsxs)("p",{children:["Paid on ",(0,f.formatDate)(O)]}),Q&&(0,b.jsxs)("p",{className:"capitalize",children:["Method: ",Q]})]})]}),(0,b.jsx)("div",{className:"space-y-2",children:y.map(a=>(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{children:a.title}),(0,b.jsx)("span",{className:"font-medium",children:(0,f.formatCurrency)(a.price)})]},a.id))})]})]}),(0,b.jsx)(j.Dialog,{open:W,onOpenChange:X,children:(0,b.jsxs)(j.DialogContent,{children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Record Payment"})}),(0,b.jsxs)("div",{className:"space-y-4 mt-4",children:[(0,b.jsxs)("div",{className:"rounded-lg bg-muted p-3",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Amount:"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:(0,f.formatCurrency)(q||0)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{children:"Payment Method"}),(0,b.jsxs)("select",{value:Y,onChange:a=>Z(a.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2",children:[(0,b.jsx)("option",{value:"cash",children:"Cash"}),(0,b.jsx)("option",{value:"check",children:"Check"}),(0,b.jsx)("option",{value:"card",children:"Credit/Debit Card"}),(0,b.jsx)("option",{value:"zelle",children:"Zelle"}),(0,b.jsx)("option",{value:"venmo",children:"Venmo"}),(0,b.jsx)("option",{value:"other",children:"Other"})]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>X(!1),className:"flex-1",children:"Cancel"}),(0,b.jsx)(k.Button,{onClick:aA,loading:U,className:"flex-1",children:"Record Payment"})]})]})]})})]})}var L=a.i(41675);function M({date:a,time:d,onDateChange:e,onTimeChange:h,label:i="Date & Time",className:j,disabled:k=!1}){let[n,o]=(0,c.useState)(null),p=a?new Date(a+"T00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}):"";return(0,b.jsxs)("div",{className:(0,f.cn)("space-y-2",j),children:[i&&(0,b.jsx)(m.Label,{className:"text-sm font-medium",children:i}),(0,b.jsxs)("div",{className:"grid gap-3 grid-cols-1 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsxs)("div",{className:(0,f.cn)("relative rounded-lg border bg-background transition-all","date"===n?"ring-2 ring-primary ring-offset-2 border-primary":"border-input hover:border-muted-foreground/50",k&&"opacity-50 cursor-not-allowed"),children:[(0,b.jsx)(L.Calendar,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none z-10"}),(0,b.jsx)(l.Input,{type:"date",value:a||"",onChange:a=>e(a.target.value),onFocus:()=>o("date"),onBlur:()=>o(null),disabled:k,className:"pl-10 border-0 focus-visible:ring-0 focus-visible:ring-offset-0 min-h-[44px] cursor-pointer bg-transparent"})]}),p&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1 ml-1",children:p})]}),(0,b.jsx)("div",{className:"space-y-1.5",children:(0,b.jsxs)("div",{className:(0,f.cn)("relative rounded-lg border bg-background transition-all","time"===n?"ring-2 ring-primary ring-offset-2 border-primary":"border-input hover:border-muted-foreground/50",k&&"opacity-50 cursor-not-allowed"),children:[(0,b.jsx)(g.Clock,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none z-10"}),(0,b.jsx)(l.Input,{type:"time",value:d||"",onChange:a=>h(a.target.value),onFocus:()=>o("time"),onBlur:()=>o(null),disabled:k,className:"pl-10 border-0 focus-visible:ring-0 focus-visible:ring-offset-0 min-h-[44px] cursor-pointer bg-transparent"})]})})]})]})}var N=a.i(210),O=a.i(24987),P=a.i(63519),Q=a.i(46842),R=a.i(83497),S=a.i(33508),T=a.i(62722),U=a.i(50522);function V({job:a,estimates:q,invoices:s,materials:v,jobHistory:B=[],teamMembers:C,companyId:F,estimatingConfig:G}){let H,V,W,X=(0,d.useRouter)(),{addToast:Y}=(0,p.useToast)(),Z=(0,e.createClient)(),[$,_]=(0,c.useState)("");(0,c.useEffect)(()=>{(async()=>{let{data:{user:a}}=await Z.auth.getUser();a&&_(a.id)})()},[Z]);let[aa,ab]=(0,c.useState)(a),[ac,ad]=(0,c.useState)(v),[ae,af]=(0,c.useState)(q),[ag,ah]=(0,c.useState)(s),[ai,aj]=(0,c.useState)([]),[ak,al]=(0,c.useState)(aa.pickup_location_id||null),[am,an]=(0,c.useState)([]),[ao,ap]=(0,c.useState)(!1),[aq,ar]=(0,c.useState)(!1),[as,at]=(0,c.useState)(null),[au,av]=(0,c.useState)(!1),[aw,ax]=(0,c.useState)({userId:$,hours:"",date:new Date().toISOString().split("T")[0]}),[ay,az]=(0,c.useState)([]);(0,c.useEffect)(()=>{ab(a),ad(v),af(q),ah(s),bB(a.scheduled_date||""),bD(a.scheduled_end_date||""),bF(a.scheduled_time||""),bH(!!a.scheduled_end_date)},[a.id,a.scheduled_date,a.scheduled_end_date,a.scheduled_time,v.length,q.length,s.length]),(0,c.useEffect)(()=>{let a=Z.channel(`job-${aa.id}-estimates`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"estimates",filter:`job_id=eq.${aa.id}`},a=>{af(b=>b.map(b=>b.id===a.new.id?{...b,...a.new}:b)),"accepted"===a.new.status&&"new"===aa.status&&ab(a=>({...a,status:"quoted"}))}).subscribe();return()=>{Z.removeChannel(a)}},[aa.id,aa.status,Z]),(0,c.useEffect)(()=>{let a=Z.channel(`job-${aa.id}-updates`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"jobs",filter:`id=eq.${aa.id}`},a=>{ab(b=>({...b,...a.new})),void 0!==a.new.scheduled_date&&bB(a.new.scheduled_date||""),void 0!==a.new.scheduled_end_date&&bD(a.new.scheduled_end_date||""),void 0!==a.new.scheduled_time&&bF(a.new.scheduled_time||""),void 0!==a.new.scheduled_end_date&&bH(!!a.new.scheduled_end_date)}).subscribe();return()=>{Z.removeChannel(a)}},[aa.id,Z]),(0,c.useEffect)(()=>{let a=Z.channel(`job-${aa.id}-invoices`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"invoices",filter:`job_id=eq.${aa.id}`},a=>{ah(b=>b.map(b=>b.id===a.new.id?{...b,...a.new}:b)),"paid"===a.new.status&&"paid"!==aa.status&&ab(a=>({...a,status:"paid"}))}).subscribe();return()=>{Z.removeChannel(a)}},[aa.id,aa.status,Z]),(0,c.useEffect)(()=>{let a=Z.channel(`job-${aa.id}-payment-line-items`).on("postgres_changes",{event:"*",schema:"public",table:"job_payment_line_items",filter:`job_id=eq.${aa.id}`},async()=>{let{data:a}=await Z.from("job_payment_line_items").select("id, title, price").eq("job_id",aa.id).order("sort_order");a&&az(a)}).subscribe();return()=>{Z.removeChannel(a)}},[aa.id,Z]);let[aA,aB]=(0,c.useState)(!1),[aC,aD]=(0,c.useState)(""),[aE,aF]=(0,c.useState)(!1);(0,c.useRef)(null);let[aG,aH]=(0,c.useState)(!1),[aI,aJ]=(0,c.useState)(!1),[aK,aL]=(0,c.useState)([{title:"",price:""}]),[aM,aN]=(0,c.useState)(""),[aO,aP]=(0,c.useState)(!1),[aQ,aR]=(0,c.useState)(!1),[aS,aT]=(0,c.useState)(!1),[aU,aV]=(0,c.useState)(null),[aW,aX]=(0,c.useState)(null),[aY,aZ]=(0,c.useState)(!1),[a$,a_]=(0,c.useState)(!1),[a0,a1]=(0,c.useState)(!1),[a2,a3]=(0,c.useState)(!1),[a4,a5]=(0,c.useState)(!1),[a6,a7]=(0,c.useState)(!1),[a8,a9]=(0,c.useState)(aa.schedule_token||null),[ba,bb]=(0,c.useState)(!1),[bc,bd]=(0,c.useState)("save"),[be,bf]=(0,c.useState)(!1),[bg,bh]=(0,c.useState)("estimate"),[bi,bj]=(0,c.useState)("generic"),[bk,bl]=(0,c.useState)(null),[bm,bn]=(0,c.useState)(!1),[bo,bp]=(0,c.useState)(!1),[bq,br]=(0,c.useState)(!1),[bs,bt]=(0,c.useState)(!1),[bu,bv]=(0,c.useState)(!1),[bw,bx]=(0,c.useState)(!1),[by,bz]=(0,c.useState)({name:"",brand:"",color:"",sheen:"",quantity:"",quantityUnit:"gal",productLine:"",area:"",notes:"",showAdvanced:!1}),[bA,bB]=(0,c.useState)(aa.scheduled_date||""),[bC,bD]=(0,c.useState)(aa.scheduled_end_date||""),[bE,bF]=(0,c.useState)(aa.scheduled_time||""),[bG,bH]=(0,c.useState)(!!aa.scheduled_end_date),[bI,bJ]=(0,c.useState)(aa.assigned_user_id||""),[bK,bL]=(0,c.useState)(aa.notes||""),bM=[aa.address1,aa.city,aa.state,aa.zip].filter(Boolean).join(", ");async function bN(){if(a8)return a8;bb(!0);try{let a=(0,f.generateToken)(24),{error:b}=await Z.from("jobs").update({schedule_token:a}).eq("id",aa.id);if(b)throw b;return a9(a),ab(b=>({...b,schedule_token:a})),a}catch(a){return console.error("Failed to generate schedule token:",a),Y("Failed to generate schedule link","error"),null}finally{bb(!1)}}async function bO(){if(!bA||!bE)return void Y("Please set both date and time","error");if(bC&&bC<bA)return void Y("End date must be after start date","error");try{let a=a8||(0,f.generateToken)(24),{error:b}=await Z.from("jobs").update({scheduled_date:bA||null,scheduled_end_date:bC||null,scheduled_time:bE||null,schedule_state:"awaiting_confirmation",schedule_token:a,updated_at:new Date().toISOString()}).eq("id",aa.id);if(b)return void Y("Failed to save schedule","error");ab(b=>({...b,scheduled_date:bA||null,scheduled_end_date:bC||null,scheduled_time:bE||null,schedule_state:"awaiting_confirmation",schedule_token:a})),a9(a),bn(!1),Y("Schedule saved - awaiting customer confirmation","success")}catch(a){console.error("Save error:",a),Y("Failed to save schedule","error")}}async function bP(){try{let{error:a}=await Z.from("jobs").update({schedule_state:"accepted",schedule_accepted_at:new Date().toISOString(),status:"scheduled",updated_at:new Date().toISOString()}).eq("id",aa.id);if(a)return void Y("Failed to accept schedule","error");ab(a=>({...a,schedule_state:"accepted",schedule_accepted_at:new Date().toISOString(),status:"scheduled"})),Y("Schedule accepted!","success")}catch(a){console.error("Accept error:",a),Y("Failed to accept schedule","error")}}async function bQ(){try{let{error:a}=await Z.from("jobs").update({assigned_user_id:bI||null,updated_at:new Date().toISOString()}).eq("id",aa.id);if(a)return void Y("Failed to save assignment","error");ab(a=>({...a,assigned_user_id:bI||null})),Y("Assignment saved","success")}catch(a){console.error("Save error:",a),Y("Failed to save assignment","error")}}async function bR(){try{let{error:a}=await Z.from("jobs").update({notes:bK||null,updated_at:new Date().toISOString()}).eq("id",aa.id);if(a)return void Y("Failed to save notes","error");ab(a=>({...a,notes:bK||null})),bt(!1),Y("Notes saved","success")}catch(a){console.error("Save error:",a),Y("Failed to save notes","error")}}async function bS(){if(!aw.hours||0>=parseFloat(aw.hours))return void Y("Please enter valid hours","error");if(!aw.userId)return void Y("Please select a worker","error");ar(!0);try{let a=parseFloat(aw.hours),b=Math.round(3600*a),c=new Date(`${aw.date}T09:00:00`),d=c.toISOString(),e=new Date(c.getTime()+1e3*b).toISOString(),{data:f,error:g}=await Z.from("time_entries").insert({job_id:aa.id,company_id:F,user_id:aw.userId,started_at:d,ended_at:e,duration_seconds:b}).select(`
          id,
          user_id,
          started_at,
          ended_at,
          duration_seconds,
          user:user_id (full_name)
        `).single();if(g)throw g;let{data:h}=await Z.from("time_entries").select(`
          id,
          user_id,
          started_at,
          ended_at,
          duration_seconds
        `).eq("job_id",aa.id).order("started_at",{ascending:!1});if(h){let a=[...new Set(h.map(a=>a.user_id).filter(a=>null!==a))],b={};if(a.length>0){let{data:c}=await Z.from("user_profiles").select("id, full_name").in("id",a);c&&(b=c.reduce((a,b)=>(a[b.id]={full_name:b.full_name||""},a),{}))}let c=h.map(a=>({...a,user:a.user_id?b[a.user_id]:null}));an(c)}ax({userId:$,hours:"",date:new Date().toISOString().split("T")[0]}),Y("Time entry added","success")}catch(a){console.error("Failed to add time entry:",a),Y("Failed to add time entry","error")}finally{ar(!1)}}async function bT(a,b){let c=Math.round(3600*b),d=am.find(b=>b.id===a);if(!d)return;let e=new Date(new Date(d.started_at).getTime()+1e3*c).toISOString(),{error:f}=await Z.from("time_entries").update({ended_at:e,duration_seconds:c}).eq("id",a);f?Y("Failed to update time entry","error"):(an(b=>b.map(b=>b.id===a?{...b,ended_at:e,duration_seconds:c}:b)),at(null),Y("Time entry updated","success"))}async function bU(a){let{error:b}=await Z.from("time_entries").delete().eq("id",a);b?Y("Failed to delete time entry","error"):(an(b=>b.filter(b=>b.id!==a)),Y("Time entry deleted","success"))}function bV(a){let b=f.JOB_STATUSES.indexOf(a);return -1===b||b===f.JOB_STATUSES.length-1?null:f.JOB_STATUSES[b+1]}async function bW(a){let{error:b}=await Z.from("jobs").update({status:a,updated_at:new Date().toISOString()}).eq("id",aa.id);b?Y("Failed to update status","error"):(ab(b=>({...b,status:a})),Y("Status updated!","success"),X.refresh())}async function bX(){let a=by.name.trim();if(!a)return void Y("Please enter a material name","error");if("paint"===bi){if(!by.color.trim())return void Y("Please enter a color","error");if(!by.sheen)return void Y("Please select a sheen","error");if(!by.area)return void Y("Please select an area","error")}let b=[],c=1,d=null;if("paint"===bi)by.brand&&b.push(by.brand),b.push(by.color),b.push(by.sheen),by.quantity&&(c=parseFloat(by.quantity)),d=by.quantityUnit,by.productLine&&b.push(`(${by.productLine})`),by.area&&b.push(`- ${by.area}`),by.notes&&b.push(`| ${by.notes}`);else{if(by.quantity){let a=parseFloat(by.quantity);isNaN(a)||(c=a),d="each"}else d="each";by.notes&&b.push(by.notes)}let e=b.length>0?b.join(" â€¢ "):null;try{let{data:b,error:f}=await Z.from("job_materials").insert({job_id:aa.id,name:a,checked:!1,notes:e,quantity_decimal:c,unit:d}).select().single();if(f){let a=f?.message||f?.details||f?.hint||JSON.stringify(f)||"Failed to add material";Y(a,"error"),console.error("Error adding material:",f);return}ad(a=>[...a,b]),bz({name:"",brand:"",quantity:"",quantityUnit:"gal",color:"",sheen:"",productLine:"",area:"",notes:"",showAdvanced:!1}),aZ(!1),aD(""),Y("paint"===bi?"Paint added!":"Material added!","success")}catch(a){console.error("Error adding material:",a),Y(a?.message||a?.details||a?.hint||JSON.stringify(a)||"Failed to add material","error")}}async function bY(a,b){let c=ac.find(b=>b.id===a);if(!c)return;let d={checked:b};if(c.inventory_item_id&&c.quantity_decimal&&["in_progress","done"].includes(aa.status)){if(b&&!c.consumed_at){let{data:a,error:b}=await Z.from("inventory_items").select("on_hand").eq("id",c.inventory_item_id).single();if(!b&&a){let b=Math.max(0,a.on_hand-(c.quantity_decimal||0));await Z.from("inventory_items").update({on_hand:b}).eq("id",c.inventory_item_id),d.consumed_at=new Date().toISOString()}}else if(!b&&c.consumed_at){let{data:a,error:b}=await Z.from("inventory_items").select("on_hand").eq("id",c.inventory_item_id).single();if(!b&&a){let b=a.on_hand+(c.quantity_decimal||0);await Z.from("inventory_items").update({on_hand:b}).eq("id",c.inventory_item_id),d.consumed_at=null}}}let{error:e}=await Z.from("job_materials").update(d).eq("id",a);e?Y("Failed to update material","error"):ad(b=>b.map(b=>b.id===a?{...b,...d}:b))}async function bZ(a){let{error:b}=await Z.from("job_materials").delete().eq("id",a);b?Y("Failed to delete material","error"):ad(b=>b.filter(b=>b.id!==a))}async function b$(a,b,c,d){let{error:e}=await Z.from("job_materials").update({cost_per_unit:b,quantity_decimal:c,unit:d}).eq("id",a);e?Y("Failed to update cost","error"):(ad(e=>e.map(e=>e.id===a?{...e,cost_per_unit:b,quantity_decimal:c,unit:d}:e)),bl(null))}function b_(){if(0===ac.length)return void Y("No materials to copy","error");let a=aa.title,b=aa.customer?.name||"Customer",c=`Materials needed for ${a} (${b}):

`;ac.forEach((a,b)=>{let d=`${b+1}. ${a.name}`;if(a.notes&&(d+=` - ${a.notes}`),a.quantity_decimal&&a.unit){let b=a.quantity_decimal%1==0?a.quantity_decimal.toFixed(0):a.quantity_decimal;d+=` - ${b} ${a.unit}`}c+=d+`
`}),c+=`
Total items: ${ac.length}`,(0,f.copyToClipboard)(c),Y("Materials list copied!","success")}function b0(){let a=a8||aa.schedule_token;return a?`/s/${a}`:""}function b1(){let a=aa.customer?.name||"there",b=bA?bC&&bC!==bA?`${(0,f.formatDate)(bA)} - ${(0,f.formatDate)(bC)}`:(0,f.formatDate)(bA):"TBD",c=bE?(0,f.formatTime)(bE):"TBD",d=b0();return`Hi ${a}. We're scheduled for ${b}${bE?` at ${c}`:""}. Confirm your appointment here: ${d}`}async function b2(){a5(!0);try{let{data:a,error:b}=await Z.from("jobs").insert({company_id:F,customer_id:aa.customer_id,title:`${aa.title} (Copy)`,address1:aa.address1,address2:aa.address2,city:aa.city,state:aa.state,zip:aa.zip,notes:aa.notes,assigned_user_id:aa.assigned_user_id,status:"new"}).select().single();if(b)throw b;if(ac.length>0){let b=ac.map(b=>({job_id:a.id,name:b.name,notes:b.notes,checked:!1})),{error:c}=await Z.from("job_materials").insert(b);c&&(console.error("Error copying materials:",c),Y("Job duplicated but materials may not have copied","error"))}Y(`Job duplicated! New job ID: ${a.id}`,"success"),(0,f.copyToClipboard)(a.id),a3(!1),X.push(`/app/jobs/${a.id}`)}catch(a){console.error("Error duplicating job:",a),Y("Failed to duplicate job","error")}finally{a5(!1)}}return(0,c.useEffect)(()=>{!async function(){let{data:a}=await Z.from("pickup_locations").select("id, name").eq("company_id",F).order("name");a&&aj(a)}()},[F]),(0,c.useEffect)(()=>{!async function(){ap(!0);let{data:a}=await Z.from("time_entries").select(`
          id,
          user_id,
          started_at,
          ended_at,
          duration_seconds
        `).eq("job_id",aa.id).order("started_at",{ascending:!1});if(a){let b=[...new Set(a.map(a=>a.user_id).filter(a=>null!==a))],c={};if(b.length>0){let{data:a}=await Z.from("user_profiles").select("id, full_name").in("id",b);a&&(c=a.reduce((a,b)=>(a[b.id]={full_name:b.full_name||""},a),{}))}an(a.map(a=>({...a,user:a.user_id?c[a.user_id]:null})))}ap(!1)}()},[aa.id,Z,C]),(0,c.useEffect)(()=>{$&&!aw.userId&&ax(a=>({...a,userId:$}))},[$]),(0,c.useEffect)(()=>{!async function(){let{data:a}=await Z.from("job_payment_line_items").select("id, title, price").eq("job_id",aa.id).order("sort_order");if(a&&az(a),"proposed"===aa.payment_state||"approved"===aa.payment_state){let{data:a}=await Z.from("estimates").select("id, public_token").eq("job_id",aa.id).maybeSingle();a?.public_token&&0===ae.length&&af([{...ae[0]||{},public_token:a.public_token}])}}()},[aa.id,aa.payment_state]),(0,c.useEffect)(()=>{aa.schedule_token&&!a8&&a9(aa.schedule_token)},[aa,a8]),(0,c.useEffect)(()=>{let a=()=>{X.refresh()};return window.addEventListener("focus",a),()=>window.removeEventListener("focus",a)},[X]),(0,b.jsxs)("div",{className:"min-h-screen pb-20 lg:pb-0",children:[(0,b.jsx)("div",{className:"border-b bg-card",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto p-4",children:[(0,b.jsxs)("button",{onClick:()=>X.back(),className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground mb-4 touch-target",children:[(0,b.jsx)(N.ArrowLeft,{className:"h-4 w-4"}),"Back"]}),(0,b.jsx)("div",{className:"flex flex-col gap-4",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h1",{className:"text-xl sm:text-2xl font-bold truncate",children:aa.title}),aa.customer&&(0,b.jsxs)("p",{className:"text-muted-foreground flex items-center gap-1 mt-1 text-sm sm:text-base min-w-0",children:[(0,b.jsx)(Q.User,{className:"h-4 w-4 shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:aa.customer.name})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[(0,b.jsx)(E.Badge,{className:(0,f.cn)("w-fit text-base px-4 py-2",f.JOB_STATUS_COLORS[aa.status]),children:f.JOB_STATUS_LABELS[aa.status]}),bV(aa.status)&&(0,b.jsx)(k.Button,{variant:"outline",size:"sm",onClick:function(){let a=bV(aa.status);a&&bW(a)},className:"touch-target min-h-[44px]",title:`Move to ${f.JOB_STATUS_LABELS[bV(aa.status)]}`,children:(0,b.jsx)(U.ChevronRight,{className:"h-4 w-4"})})]})]})})]})}),(0,b.jsx)("div",{className:"max-w-4xl mx-auto p-4",children:(0,b.jsx)("div",{className:"space-y-6",children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"rounded-lg border bg-card p-2.5",children:(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm",children:[bM&&(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)(O.MapPin,{className:"h-4 w-4 text-muted-foreground shrink-0"}),(0,b.jsx)("span",{children:bM})]}),aa.customer?.phone&&(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)(P.Phone,{className:"h-4 w-4 text-muted-foreground shrink-0"}),(0,b.jsx)("a",{href:`tel:${aa.customer.phone}`,className:"hover:underline",children:aa.customer.phone})]}),aa.customer?.email&&(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)(w.Mail,{className:"h-4 w-4 text-muted-foreground shrink-0"}),(0,b.jsx)("a",{href:`mailto:${aa.customer.email}`,className:"hover:underline",children:aa.customer.email})]})]})}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(K,{jobId:aa.id,companyId:F,customerId:aa.customer_id,paymentState:aa.payment_state||"none",paymentAmount:aa.payment_amount||null,paymentApprovedAt:aa.payment_approved_at||null,paymentPaidAt:aa.payment_paid_at||null,paymentMethod:aa.payment_method||null,publicToken:ae[0]?.public_token,lineItems:ay,estimatingConfig:G,estimateStatus:ae[0]?.status||null,estimateDeniedAt:ae[0]?.denied_at||null,estimateDenialReason:ae[0]?.denial_reason||null,onUpdate:async()=>{let{data:a}=await Z.from("estimates").select("*").eq("job_id",aa.id).order("created_at",{ascending:!1});a&&af(await Promise.all(a.map(async a=>{let{data:b}=await Z.from("estimate_line_items").select("*").eq("estimate_id",a.id);return{...a,line_items:b||[]}})))}}),(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-4 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Schedule"}),"accepted"===aa.schedule_state&&(0,b.jsxs)(E.Badge,{variant:"success",children:[(0,b.jsx)(h.CheckCircle,{className:"h-3 w-3 mr-1"}),"Confirmed"]}),("proposed"===aa.schedule_state||"awaiting_confirmation"===aa.schedule_state)&&(0,b.jsx)(E.Badge,{variant:"secondary",children:"Awaiting Confirmation"}),"denied"===aa.schedule_state&&(0,b.jsx)(E.Badge,{variant:"destructive",children:"Declined by Customer"})]}),bA&&bE&&!bm&&(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>bn(!0),className:"touch-target min-h-[44px]",children:(0,b.jsx)(J.Pencil,{className:"h-4 w-4"})})]}),!bm&&bA&&bE?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"p-3 sm:p-4 rounded-lg bg-muted/30 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-start gap-2 sm:gap-3 min-w-0",children:[(0,b.jsx)(L.Calendar,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary shrink-0 mt-1"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:bC&&bC!==bA?"Date Range":"Date"}),(0,b.jsx)("p",{className:"font-medium text-sm sm:text-base break-words",children:bC&&bC!==bA?`${(0,f.formatDate)(bA)} - ${(0,f.formatDate)(bC)}`:(0,f.formatDate)(bA)})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2 sm:gap-3 min-w-0",children:[(0,b.jsx)(g.Clock,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary shrink-0 mt-1"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:bC&&bC!==bA?"Daily Arrival Time":"Time"}),(0,b.jsx)("p",{className:"font-medium text-sm sm:text-base",children:(0,f.formatTime)(bE)})]})]})]}),("proposed"===aa.schedule_state||"awaiting_confirmation"===aa.schedule_state)&&(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,b.jsxs)(k.Button,{variant:"outline",onClick:async()=>{await bN(),a1(!0)},className:"w-full sm:flex-1",children:[(0,b.jsx)(I,{className:"mr-2 h-4 w-4"}),"Share with Customer"]}),(0,b.jsxs)(k.Button,{onClick:bP,className:"w-full sm:flex-1",children:[(0,b.jsx)(h.CheckCircle,{className:"mr-2 h-4 w-4"}),"Mark Confirmed"]})]}),"accepted"===aa.schedule_state&&(0,b.jsx)("div",{className:"p-3 rounded-lg bg-success/10 border border-success/20 text-sm",children:(0,b.jsxs)("p",{className:"flex items-center gap-2 text-success",children:[(0,b.jsx)(h.CheckCircle,{className:"h-4 w-4"}),(0,b.jsxs)("span",{children:["Customer confirmed on ",(0,f.formatDate)(aa.schedule_accepted_at)]})]})}),"denied"===aa.schedule_state&&(0,b.jsxs)("div",{className:"p-3 rounded-lg bg-destructive/10 border border-destructive/20 space-y-2",children:[(0,b.jsxs)("p",{className:"flex items-center gap-2 text-destructive text-sm font-medium",children:[(0,b.jsx)(T.XCircle,{className:"h-4 w-4"}),"Customer declined this schedule"]}),aa.schedule_denial_reason&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground pl-6",children:["Reason: ",aa.schedule_denial_reason]}),(0,b.jsxs)(k.Button,{variant:"outline",size:"sm",onClick:()=>bn(!0),className:"w-full sm:w-auto",children:[(0,b.jsx)(L.Calendar,{className:"mr-2 h-4 w-4"}),"Propose New Time"]})]}),!aa.schedule_state&&(0,b.jsxs)(k.Button,{variant:"outline",onClick:async()=>{await bN(),a1(!0)},className:"w-full",children:[(0,b.jsx)(I,{className:"mr-2 h-4 w-4"}),"Share with Customer"]})]}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(M,{date:bA||null,time:bE||null,onDateChange:a=>bB(a),onTimeChange:a=>bF(a),label:bG?"Start date and daily arrival time":"Date and time"}),(0,b.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg border bg-muted/30",children:[(0,b.jsx)("input",{type:"checkbox",id:"multiDayToggle",checked:bG,onChange:a=>{bH(a.target.checked),a.target.checked||bD("")},className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-2 focus:ring-primary cursor-pointer"}),(0,b.jsx)("label",{htmlFor:"multiDayToggle",className:"text-sm font-medium cursor-pointer flex-1",children:"Multi-day job"})]}),bG&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"End date"}),(0,b.jsx)("input",{type:"date",value:bC,onChange:a=>bD(a.target.value),min:bA||void 0,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 min-h-[44px]"}),bC&&bC<bA&&(0,b.jsxs)("p",{className:"text-xs text-destructive flex items-center gap-1",children:[(0,b.jsx)("span",{children:"âš ï¸"}),"End date must be after start date"]}),bC&&bC>=bA&&bE&&(0,b.jsx)("div",{className:"p-3 rounded-lg bg-primary/10 border border-primary/20",children:(0,b.jsxs)("p",{className:"text-xs text-foreground flex items-start gap-2",children:[(0,b.jsx)(L.Calendar,{className:"h-4 w-4 text-primary shrink-0 mt-0.5"}),(0,b.jsxs)("span",{children:["Crew will arrive at ",(0,b.jsx)("strong",{children:(0,f.formatTime)(bE)})," each day from ",(0,b.jsx)("strong",{children:(0,f.formatDate)(bA)})," to ",(0,b.jsx)("strong",{children:(0,f.formatDate)(bC)})]})]})})]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[bA&&bE&&(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>{bn(!1),bB(aa.scheduled_date||""),bD(aa.scheduled_end_date||""),bF(aa.scheduled_time||""),bH(!!aa.scheduled_end_date)},className:"w-full sm:w-auto",children:"Cancel"}),(0,b.jsxs)(k.Button,{onClick:bO,className:"w-full sm:flex-1",children:[(0,b.jsx)(L.Calendar,{className:"mr-2 h-4 w-4"}),bA&&bE&&aa.scheduled_date?"Update Schedule":"Save Schedule"]})]})]})]}),(0,b.jsx)("div",{className:"rounded-lg border bg-card p-4 space-y-6",children:!bu&&ac.length>0?(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("h3",{className:"font-semibold text-lg",children:["Materials (",ac.length,")"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(k.Button,{variant:"outline",size:"sm",onClick:()=>{bh("materials"),bf(!0)},className:"touch-target min-h-[44px]",children:[(0,b.jsx)(I,{className:"mr-2 h-4 w-4"}),"Share List"]}),(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>bv(!0),className:"touch-target min-h-[44px]",children:(0,b.jsx)(J.Pencil,{className:"h-4 w-4"})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[ac.slice(0,5).map(a=>(0,b.jsxs)("div",{className:"flex items-start gap-3 p-2 rounded-lg hover:bg-muted/50",children:[(0,b.jsx)(y.SimpleCheckbox,{checked:a.checked,onChange:b=>bY(a.id,b.target.checked),className:"mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("span",{className:(0,f.cn)("font-medium text-sm",a.checked&&"line-through text-muted-foreground"),children:a.name}),a.notes&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-0.5",children:a.notes}),(a.quantity_decimal||a.unit)&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[a.quantity_decimal&&`${a.quantity_decimal} `,a.unit||"each"]})]})]},a.id)),ac.length>5&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground pt-1 pl-2",children:["+",ac.length-5," more"]})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"font-semibold text-lg",children:"Materials"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[ac.length>0&&(0,b.jsxs)(k.Button,{variant:"outline",size:"sm",onClick:()=>{bh("materials"),bf(!0)},className:"touch-target min-h-[44px]",children:[(0,b.jsx)(I,{className:"mr-2 h-4 w-4"}),"Share List"]}),bu&&ac.length>0&&(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>bv(!1),children:(0,b.jsx)(S.X,{className:"h-4 w-4"})})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("h4",{className:"font-medium text-sm",children:["Checklist (",ac.length,")"]}),ac.length>0&&(0,b.jsxs)(k.Button,{variant:"outline",size:"sm",onClick:b_,className:"touch-target min-h-[44px]",children:[(0,b.jsx)(r,{className:"mr-2 h-4 w-4"}),"Copy List"]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{className:"text-sm text-muted-foreground",children:"Quick Add"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsxs)(k.Button,{variant:"outline",size:"sm",onClick:()=>{bj("paint"),bz({name:"Paint",brand:"",color:"",sheen:"",quantity:"",quantityUnit:"gal",productLine:"",area:"",notes:"",showAdvanced:!1}),aZ(!0)},className:"touch-target min-h-[44px] justify-start",children:[(0,b.jsx)(t.Plus,{className:"mr-2 h-4 w-4"}),"Paint"]}),(0,b.jsxs)(k.Button,{variant:"outline",size:"sm",onClick:()=>{bj("generic"),bz({name:"",brand:"",color:"",sheen:"",quantity:"",quantityUnit:"gal",productLine:"",area:"",notes:"",showAdvanced:!1}),aZ(!0)},className:"touch-target min-h-[44px] justify-start",children:[(0,b.jsx)(t.Plus,{className:"mr-2 h-4 w-4"}),"Custom"]})]})]}),(0,b.jsx)("div",{className:"rounded-lg border bg-muted/30 divide-y",children:0===ac.length?(0,b.jsxs)("div",{className:"p-8 text-center text-muted-foreground",children:[(0,b.jsx)(R.Package,{className:"mx-auto h-8 w-8 mb-2"}),(0,b.jsx)("p",{className:"text-sm",children:"No materials yet"}),(0,b.jsx)("p",{className:"text-xs mt-1",children:"Use Quick Add buttons above"})]}):ac.map(a=>(0,b.jsxs)("div",{className:"p-3 space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(y.SimpleCheckbox,{checked:a.checked,onChange:b=>bY(a.id,b.target.checked)}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("span",{className:(0,f.cn)("font-medium",a.checked&&"line-through text-muted-foreground"),children:a.name}),a.notes&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-0.5",children:a.notes})]}),(0,b.jsx)("button",{onClick:()=>bZ(a.id),className:"text-muted-foreground hover:text-destructive touch-target min-h-[44px] min-w-[44px] flex items-center justify-center",children:(0,b.jsx)(u.Trash2,{className:"h-4 w-4"})})]}),bk===a.id?(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm pl-8",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"$"}),(0,b.jsx)(l.Input,{type:"number",step:"0.01",min:"0",placeholder:"0.00",defaultValue:a.cost_per_unit||"",className:"w-20 h-8 text-sm",id:`cost-${a.id}`}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"per"}),(0,b.jsx)(l.Input,{type:"text",placeholder:"unit",defaultValue:a.unit||"each",className:"w-20 h-8 text-sm",id:`unit-${a.id}`}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Ã—"}),(0,b.jsx)(l.Input,{type:"number",step:"0.01",min:"0",placeholder:"qty",defaultValue:a.quantity_decimal||"",className:"w-16 h-8 text-sm",id:`qty-${a.id}`}),(0,b.jsx)(k.Button,{size:"sm",variant:"ghost",className:"h-8",onClick:()=>{let b=document.getElementById(`cost-${a.id}`),c=document.getElementById(`unit-${a.id}`),d=document.getElementById(`qty-${a.id}`);b$(a.id,b.value?parseFloat(b.value):null,d.value?parseFloat(d.value):null,c.value||null)},children:"Save"}),(0,b.jsx)(k.Button,{size:"sm",variant:"ghost",className:"h-8",onClick:()=>bl(null),children:"Cancel"})]}):a.cost_per_unit?(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm pl-8",children:[(0,b.jsxs)("span",{className:"text-muted-foreground",children:[(0,f.formatCurrency)(Math.round(100*a.cost_per_unit))," per ",a.unit||"each",a.quantity_decimal&&` \xd7 ${a.quantity_decimal}`,a.quantity_decimal&&a.cost_per_unit&&(0,b.jsxs)("span",{className:"font-medium ml-2",children:["= ",(0,f.formatCurrency)(Math.round(a.cost_per_unit*a.quantity_decimal*100))]})]}),(0,b.jsx)(k.Button,{size:"sm",variant:"ghost",className:"h-6 text-xs",onClick:()=>bl(a.id),children:"Edit"})]}):(0,b.jsx)("div",{className:"pl-8",children:(0,b.jsx)(k.Button,{size:"sm",variant:"ghost",className:"h-6 text-xs text-muted-foreground",onClick:()=>bl(a.id),children:"+ Add cost"})})]},a.id))}),(()=>{let a=ac.filter(a=>a.cost_per_unit&&a.quantity_decimal);if(0===a.length)return null;let c=a.reduce((a,b)=>a+(b.cost_per_unit||0)*(b.quantity_decimal||0),0),d=ac.length===a.length,e=ag[0];return(0,b.jsxs)("div",{className:"rounded-lg border bg-muted/50 p-3 space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsxs)("span",{className:"text-muted-foreground",children:["Materials Total",!d&&(0,b.jsx)("span",{className:"text-xs ml-1",children:"(partial)"})]}),(0,b.jsx)("span",{className:"font-medium",children:(0,f.formatCurrency)(Math.round(100*c))})]}),e&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Invoice Total"}),(0,b.jsx)("span",{className:"font-medium",children:(0,f.formatCurrency)(e.amount_total)})]}),(0,b.jsx)("div",{className:"h-px bg-border"}),(0,b.jsxs)("div",{className:"flex justify-between font-semibold",children:[(0,b.jsx)("span",{children:"Estimated Margin"}),(0,b.jsxs)("span",{className:(0,f.cn)(e.amount_total-Math.round(100*c)>0?"text-success":"text-destructive"),children:[(0,f.formatCurrency)(e.amount_total-Math.round(100*c)),(0,b.jsxs)("span",{className:"text-xs ml-1 font-normal",children:["(",Math.round((e.amount_total-Math.round(100*c))/e.amount_total*100),"%)"]})]})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"âš ï¸ Materials only - doesn't include labor or overhead"})]})]})})()]})]})}),(0,b.jsx)("div",{className:"rounded-lg border bg-card p-4",children:bo?(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(m.Label,{htmlFor:"assignedUser",className:"text-sm font-medium whitespace-nowrap shrink-0",children:"Who's working on this?"}),(0,b.jsxs)(o.Select,{id:"assignedUser",value:bI,onChange:a=>bJ(a.target.value),className:"flex-1 h-9",children:[(0,b.jsx)("option",{value:"",children:"Unassigned"}),C.map(a=>(0,b.jsx)("option",{value:a.id,children:a.fullName},a.id))]}),(0,b.jsx)(k.Button,{onClick:async()=>{await bQ(),bp(!1)},className:"shrink-0 h-9",children:"Save"})]}):(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold mb-1",children:"Assign To"}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:bI?(0,b.jsx)("span",{children:C.find(a=>a.id===bI)?.fullName||"Unknown"}):(0,b.jsx)("span",{children:"Unassigned"})})]}),(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>bp(!0),className:"touch-target min-h-[44px]",children:(0,b.jsx)(J.Pencil,{className:"h-4 w-4"})})]})}),(0,b.jsx)("div",{className:"rounded-lg border bg-card p-4 space-y-4",children:!bs&&bK?(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Notes"}),(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>bt(!0),className:"touch-target min-h-[44px]",children:(0,b.jsx)(J.Pencil,{className:"h-4 w-4"})})]}),(0,b.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:bK})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Notes"}),bs&&bK&&(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>bt(!1),children:(0,b.jsx)(S.X,{className:"h-4 w-4"})})]}),(0,b.jsx)(n.Textarea,{value:bK,onChange:a=>{bL(a.target.value)},placeholder:"Add notes about this job...",rows:4}),(0,b.jsxs)(k.Button,{onClick:bR,className:"w-full",children:[(0,b.jsx)(z,{className:"mr-2 h-4 w-4"}),"Save Notes"]})]})}),(0,b.jsx)("div",{className:"rounded-lg border bg-card p-4 space-y-4",children:!bq&&am.length>0?(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Time Tracking"}),(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>br(!0),className:"touch-target min-h-[44px]",children:(0,b.jsx)(J.Pencil,{className:"h-4 w-4"})})]}),(0,b.jsx)("div",{className:"space-y-2",children:Object.entries(am.reduce((a,b)=>{let c=b.user_id||"unknown",d="unknown"!==c&&(C.find(a=>a.id===c)?.fullName||b.user?.full_name)||"Unknown";a[c]||(a[c]={name:d,totalHours:0,entries:[]});let e=b.duration_seconds?b.duration_seconds/3600:0;return a[c].totalHours+=e,a[c].entries.push(b),a},{})).map(([a,c])=>(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-lg border bg-muted/30 p-2",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:c.name}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:[c.totalHours.toFixed(1),"h"]})]},a))})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Time Tracking"}),bq&&am.length>0&&(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>br(!1),children:(0,b.jsx)(S.X,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(m.Label,{className:"text-sm font-medium",children:"Time Logs"}),(0,b.jsxs)(k.Button,{size:"sm",onClick:()=>av(!0),className:"touch-target min-h-[44px]",children:[(0,b.jsx)(t.Plus,{className:"mr-2 h-4 w-4"}),"Add Hours"]})]}),ao?(0,b.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Loading..."}):0===am.length?(0,b.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No time entries yet"}):(0,b.jsx)("div",{className:"space-y-2",children:am.map(a=>{let c=a.duration_seconds?(a.duration_seconds/3600).toFixed(1):"0",d=new Date(a.started_at).toLocaleDateString([],{month:"short",day:"numeric"}),e=a.user_id&&(C.find(b=>b.id===a.user_id)?.fullName||a.user?.full_name)||"Unknown";return(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-lg border bg-muted/30 p-3",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:e}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[d," â€¢ ",c,"h"]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:as===a.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Input,{type:"number",step:"0.25",min:"0",defaultValue:c,className:"w-20 h-8 text-sm",onBlur:b=>{let c=parseFloat(b.target.value);!isNaN(c)&&c>0?bT(a.id,c):at(null)},onKeyDown:b=>{if("Enter"===b.key){let c=parseFloat(b.target.value);!isNaN(c)&&c>0?bT(a.id,c):at(null)}else"Escape"===b.key&&at(null)},autoFocus:!0}),(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>at(null),className:"h-8",children:(0,b.jsx)(S.X,{className:"h-3 w-3"})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{onClick:()=>at(a.id),className:"text-muted-foreground hover:text-foreground",title:"Edit hours",children:(0,b.jsx)(J.Pencil,{className:"h-4 w-4"})}),(0,b.jsx)("button",{onClick:()=>bU(a.id),className:"text-muted-foreground hover:text-destructive",title:"Delete entry",children:(0,b.jsx)(u.Trash2,{className:"h-4 w-4"})})]})})]},a.id)})})]})]})}),(0,b.jsx)("div",{className:"rounded-lg border bg-card p-4 space-y-4",children:bw?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Photos"}),(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>bx(!1),children:(0,b.jsx)(S.X,{className:"h-4 w-4"})})]}),(0,b.jsx)(D,{jobId:aa.id,companyId:F})]}):(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Photos"}),(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>bx(!0),className:"touch-target min-h-[44px]",children:(0,b.jsx)(J.Pencil,{className:"h-4 w-4"})})]}),(0,b.jsx)(D,{jobId:aa.id,companyId:F,compact:!0})]})}),B.length>0&&(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-4 space-y-4",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"History"}),(0,b.jsx)(i,{history:B})]})]})]})})}),(0,b.jsx)(x,{open:aS,onOpenChange:aT,companyId:F,job:aa,customer:aa.customer,invoices:ag,scheduledDate:bA,scheduledTime:bE,address:bM}),(0,b.jsx)(j.Dialog,{open:!!aU,onOpenChange:a=>!a&&aV(null),children:(0,b.jsxs)(j.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Estimate Details"})}),aU&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(E.Badge,{variant:"accepted"===aU.status?"success":"sent"===aU.status?"secondary":"outline",children:aU.status}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Created ",(0,f.formatDate)(aU.created_at)]})]}),(0,b.jsx)("div",{className:"rounded-lg border divide-y",children:aU.line_items.map(a=>(0,b.jsx)("div",{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.name}),a.description&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:a.description})]}),(0,b.jsx)("p",{className:"font-medium",children:(0,f.formatCurrency)(a.price)})]})},a.id))}),(0,b.jsx)("div",{className:"p-4 border-t bg-muted/50 rounded-b-lg",children:(0,b.jsxs)("div",{className:"flex items-center justify-between text-lg font-semibold",children:[(0,b.jsx)("span",{children:"Total"}),(0,b.jsx)("span",{children:(0,f.formatCurrency)(aU.line_items.reduce((a,b)=>a+b.price,0))})]})})]})]})}),(0,b.jsx)(j.Dialog,{open:!!aW,onOpenChange:a=>!a&&aX(null),children:(0,b.jsxs)(j.DialogContent,{className:"max-w-lg",children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Invoice Details"})}),aW&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(E.Badge,{variant:"paid"===aW.status?"success":"sent"===aW.status?"secondary":"outline",children:aW.status}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Created ",(0,f.formatDate)(aW.created_at)]})]}),(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-6 text-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Amount Due"}),(0,b.jsx)("p",{className:"text-4xl font-bold",children:(0,f.formatCurrency)(aW.amount_total)})]}),"paid"===aW.status&&aW.paid_at&&(0,b.jsxs)("div",{className:"bg-success/10 text-success rounded-lg p-4 text-center",children:[(0,b.jsx)("p",{className:"font-semibold",children:"Paid"}),(0,b.jsxs)("p",{className:"text-sm",children:["on ",(0,f.formatDate)(aW.paid_at)]})]})]})]})}),(0,b.jsx)(j.Dialog,{open:aY,onOpenChange:aZ,children:(0,b.jsxs)(j.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"paint"===bi?"Add Paint":"Add Material"})}),(0,b.jsxs)("div",{className:"space-y-4",children:["paint"===bi?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"paintArea",children:"Area / Use *"}),(0,b.jsxs)(o.Select,{id:"paintArea",value:by.area,onChange:a=>bz({...by,area:a.target.value}),className:"min-h-[44px]",children:[(0,b.jsx)("option",{value:"",children:"Select area..."}),(0,b.jsxs)("optgroup",{label:"Interior",children:[(0,b.jsx)("option",{value:"Interior Walls",children:"Interior Walls"}),(0,b.jsx)("option",{value:"Ceiling",children:"Ceiling"}),(0,b.jsx)("option",{value:"Interior Trim",children:"Interior Trim"}),(0,b.jsx)("option",{value:"Doors",children:"Doors"})]}),(0,b.jsxs)("optgroup",{label:"Exterior",children:[(0,b.jsx)("option",{value:"Exterior Walls",children:"Exterior Walls"}),(0,b.jsx)("option",{value:"Exterior Trim",children:"Exterior Trim"}),(0,b.jsx)("option",{value:"Deck/Fence",children:"Deck/Fence"}),(0,b.jsx)("option",{value:"Siding",children:"Siding"})]}),(0,b.jsx)("option",{value:"Other",children:"Other"})]})]}),(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"paintBrand",children:"Brand (Optional)"}),(0,b.jsxs)(o.Select,{id:"paintBrand",value:by.brand,onChange:a=>bz({...by,brand:a.target.value}),className:"min-h-[44px]",children:[(0,b.jsx)("option",{value:"",children:"Select brand..."}),(0,b.jsx)("option",{value:"Sherwin-Williams",children:"Sherwin-Williams"}),(0,b.jsx)("option",{value:"Benjamin Moore",children:"Benjamin Moore"}),(0,b.jsx)("option",{value:"Behr",children:"Behr"}),(0,b.jsx)("option",{value:"PPG",children:"PPG"}),(0,b.jsx)("option",{value:"Other",children:"Other"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"paintColor",children:"Color *"}),(0,b.jsx)(l.Input,{id:"paintColor",value:by.color,onChange:a=>bz({...by,color:a.target.value}),placeholder:"e.g., SW 7008 Alabaster",className:"min-h-[44px]"})]})]}),(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"paintSheen",children:"Sheen *"}),(0,b.jsxs)(o.Select,{id:"paintSheen",value:by.sheen,onChange:a=>bz({...by,sheen:a.target.value}),className:"min-h-[44px]",children:[(0,b.jsx)("option",{value:"",children:"Select sheen..."}),(0,b.jsx)("option",{value:"Flat",children:"Flat"}),(0,b.jsx)("option",{value:"Matte",children:"Matte"}),(0,b.jsx)("option",{value:"Eggshell",children:"Eggshell"}),(0,b.jsx)("option",{value:"Satin",children:"Satin"}),(0,b.jsx)("option",{value:"Semi-Gloss",children:"Semi-Gloss"}),(0,b.jsx)("option",{value:"Gloss",children:"Gloss"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"paintQuantity",children:"Quantity"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(l.Input,{id:"paintQuantity",type:"number",min:"0",step:"0.25",value:by.quantity,onChange:a=>bz({...by,quantity:a.target.value}),placeholder:"e.g., 3",className:"min-h-[44px] flex-1"}),(0,b.jsxs)(o.Select,{value:by.quantityUnit,onChange:a=>bz({...by,quantityUnit:a.target.value}),className:"min-h-[44px] w-28",children:[(0,b.jsx)("option",{value:"gal",children:"Gallons"}),(0,b.jsx)("option",{value:"qt",children:"Quarts"}),(0,b.jsx)("option",{value:"pt",children:"Pints"}),(0,b.jsx)("option",{value:"oz",children:"Oz"})]})]})]})]}),(0,b.jsxs)("button",{type:"button",onClick:()=>bz({...by,showAdvanced:!by.showAdvanced}),className:"text-sm text-muted-foreground hover:text-foreground flex items-center gap-1",children:[by.showAdvanced?"Hide":"Show"," advanced options"]}),by.showAdvanced&&(0,b.jsxs)("div",{className:"rounded-lg border bg-muted/30 p-4 space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"paintProductLine",children:"Product Line"}),(0,b.jsx)(l.Input,{id:"paintProductLine",value:by.productLine,onChange:a=>bz({...by,productLine:a.target.value}),placeholder:"e.g., Duration, Emerald",className:"min-h-[44px]"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"paintNotes",children:"Notes"}),(0,b.jsx)(n.Textarea,{id:"paintNotes",value:by.notes,onChange:a=>bz({...by,notes:a.target.value}),placeholder:"e.g., Back wall only, Second coat needed",rows:2})]})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"materialName",children:"Material Name *"}),(0,b.jsx)(l.Input,{id:"materialName",value:by.name,onChange:a=>bz({...by,name:a.target.value}),placeholder:"e.g., Roller Set, Tape, Drop Cloth",className:"min-h-[44px]",autoFocus:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"materialQuantity",children:"Quantity"}),(0,b.jsx)(l.Input,{id:"materialQuantity",value:by.quantity,onChange:a=>bz({...by,quantity:a.target.value}),placeholder:"e.g., 2 rolls, 1 set, 3 brushes",className:"min-h-[44px]"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"materialNotes",children:"Notes (Optional)"}),(0,b.jsx)(n.Textarea,{id:"materialNotes",value:by.notes,onChange:a=>bz({...by,notes:a.target.value}),placeholder:"Any additional details...",rows:2})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,b.jsx)(k.Button,{type:"button",variant:"outline",onClick:()=>{aZ(!1),bz({name:"",brand:"",quantity:"",quantityUnit:"gal",color:"",sheen:"",productLine:"",area:"",notes:"",showAdvanced:!1})},children:"Cancel"}),(0,b.jsxs)(k.Button,{onClick:bX,disabled:!by.name.trim()||"paint"===bi&&(!by.color.trim()||!by.sheen||!by.area),children:["Add ","paint"===bi?"Paint":"Material"]})]})]})]})}),(0,b.jsx)(j.Dialog,{open:a0,onOpenChange:async a=>{a1(a),a&&await bN()},children:(0,b.jsxs)(j.DialogContent,{className:"max-w-lg",children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Share Schedule"})}),(0,b.jsx)("div",{className:"space-y-4",children:bA&&bE?ba?(0,b.jsx)("div",{className:"text-center py-4",children:(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Generating link..."})}):b0()?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-4",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Scheduled for"}),(0,b.jsxs)("p",{className:"font-semibold text-lg",children:[bC&&bC!==bA?`${(0,f.formatDate)(bA)} - ${(0,f.formatDate)(bC)}`:(0,f.formatDate)(bA),bE&&` at ${(0,f.formatTime)(bE)}`]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-sm text-muted-foreground",children:"Schedule Link"}),(0,b.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,b.jsx)(l.Input,{value:b0(),readOnly:!0,className:"font-mono text-sm"}),(0,b.jsx)(k.Button,{variant:"outline",onClick:function(){(0,f.copyToClipboard)(b0()),Y("Schedule link copied!","success")},disabled:ba,className:"shrink-0",children:(0,b.jsx)(r,{className:"h-4 w-4"})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-sm text-muted-foreground",children:"Pre-written Message"}),(0,b.jsx)(n.Textarea,{value:b1(),readOnly:!0,rows:4,className:"mt-2 font-sans"}),(0,b.jsxs)(k.Button,{onClick:function(){(0,f.copyToClipboard)(b1()),Y("Schedule message copied!","success")},className:"w-full mt-2",children:[(0,b.jsx)(r,{className:"mr-2 h-4 w-4"}),"Copy Message"]})]})]})]}):(0,b.jsx)("div",{className:"text-center py-4",children:(0,b.jsx)("p",{className:"text-sm text-destructive",children:"No token available"})}):(0,b.jsxs)("div",{className:"rounded-lg border bg-muted/50 p-4 text-center text-muted-foreground",children:[(0,b.jsx)(L.Calendar,{className:"mx-auto h-8 w-8 mb-2"}),(0,b.jsx)("p",{children:"This job hasn't been scheduled yet."}),(0,b.jsx)("p",{className:"text-sm mt-1",children:"Add a scheduled date and time first."})]})})]})}),(0,b.jsx)(j.Dialog,{open:a2,onOpenChange:a3,children:(0,b.jsxs)(j.DialogContent,{className:"max-w-md",children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Duplicate Job?"})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"This will create a new job with the same customer, address, and materials."}),(0,b.jsxs)("div",{className:"rounded-lg border bg-muted/50 p-3 space-y-2",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Will be copied:"}),(0,b.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1 list-disc list-inside",children:[(0,b.jsx)("li",{children:"Customer & address"}),(0,b.jsx)("li",{children:"Notes"}),(0,b.jsx)("li",{children:"Assigned team member"}),(0,b.jsxs)("li",{children:["Materials (",ac.length," items)"]})]})]}),(0,b.jsxs)("div",{className:"rounded-lg border bg-warning/10 p-3 space-y-2",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-warning",children:"Will NOT be copied:"}),(0,b.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1 list-disc list-inside",children:[(0,b.jsx)("li",{children:"Schedule (will be unscheduled)"}),(0,b.jsx)("li",{children:'Status (will reset to "new")'}),(0,b.jsx)("li",{children:"Estimates & invoices"})]})]}),(0,b.jsxs)("div",{className:"flex gap-3 justify-end pt-2",children:[(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>a3(!1),disabled:a4,children:"Cancel"}),(0,b.jsxs)(k.Button,{onClick:b2,loading:a4,children:[(0,b.jsx)(r,{className:"mr-2 h-4 w-4"}),"Duplicate"]})]})]})]})}),(0,b.jsx)(A,{open:a6,onOpenChange:a7,mode:bc,jobId:aa.id,companyId:F,onRefresh:()=>X.refresh()}),(0,b.jsx)(j.Dialog,{open:au,onOpenChange:av,children:(0,b.jsxs)(j.DialogContent,{className:"max-w-md",children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Add Hours"})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"timeWorker",children:"Worker"}),(0,b.jsxs)(o.Select,{id:"timeWorker",value:aw.userId,onChange:a=>ax({...aw,userId:a.target.value}),children:[(0,b.jsx)("option",{value:"",children:"Select worker"}),C.map(a=>(0,b.jsx)("option",{value:a.id,children:a.fullName},a.id))]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"timeDate",children:"Date"}),(0,b.jsx)(l.Input,{id:"timeDate",type:"date",value:aw.date,onChange:a=>ax({...aw,date:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"timeHours",children:"Hours"}),(0,b.jsx)(l.Input,{id:"timeHours",type:"number",step:"0.25",min:"0",placeholder:"0.0",value:aw.hours,onChange:a=>ax({...aw,hours:a.target.value})})]}),(0,b.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>av(!1),children:"Cancel"}),(0,b.jsxs)(k.Button,{onClick:async()=>{await bS(),av(!1),ax({userId:$,hours:"",date:new Date().toISOString().split("T")[0]})},loading:aq,disabled:!aw.hours||!aw.userId,children:[(0,b.jsx)(t.Plus,{className:"mr-2 h-4 w-4"}),"Add Hours"]})]})]})]})}),(0,b.jsx)(j.Dialog,{open:be,onOpenChange:bf,children:(0,b.jsxs)(j.DialogContent,{className:"max-w-lg",children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsxs)(j.DialogTitle,{children:["estimate"===bg&&"Estimate Message","invoice"===bg&&"Invoice Message","materials"===bg&&"Materials List","reminder"===bg&&"Reminder Message","schedule-confirmation"===bg&&"Schedule Confirmation"]})}),(0,b.jsxs)("div",{className:"space-y-4",children:["estimate"===bg&&ae[0]&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-sm text-muted-foreground",children:"Estimate Link"}),(0,b.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,b.jsx)(l.Input,{value:`/e/${ae[0].public_token}`,readOnly:!0,className:"font-mono text-sm"}),(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>{(0,f.copyToClipboard)(`/e/${ae[0].public_token}`),Y("Link copied!","success")},className:"shrink-0",children:(0,b.jsx)(r,{className:"h-4 w-4"})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-sm text-muted-foreground",children:"Pre-written Message"}),(0,b.jsx)(n.Textarea,{value:`Hey ${aa.customer?.name||"there"} â€” here's your estimate for ${(0,f.formatCurrency)(ae[0].line_items.reduce((a,b)=>a+b.price,0))}: /e/${ae[0].public_token}. Let me know if you have any questions!`,readOnly:!0,rows:4,className:"mt-2 font-sans"}),(0,b.jsxs)(k.Button,{onClick:()=>{let a,b,c,d,e;a=aa.customer?.name||"there",c=(b=ae[0])?`/e/${b.public_token}`:"[estimate link]",d=b?(0,f.formatCurrency)(b.line_items.reduce((a,b)=>a+b.price,0)):"[amount]",e=`Hey ${a} â€” here's your estimate for ${d}: ${c}. Let me know if you have any questions!`,(0,f.copyToClipboard)(e),Y("Estimate message copied!","success"),bf(!1)},className:"w-full mt-2",children:[(0,b.jsx)(r,{className:"mr-2 h-4 w-4"}),"Copy Message"]})]})]}),"invoice"===bg&&ag[0]&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-sm text-muted-foreground",children:"Invoice Link"}),(0,b.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,b.jsx)(l.Input,{value:`/i/${ag[0].public_token}`,readOnly:!0,className:"font-mono text-sm"}),(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>{(0,f.copyToClipboard)(`/i/${ag[0].public_token}`),Y("Link copied!","success")},className:"shrink-0",children:(0,b.jsx)(r,{className:"h-4 w-4"})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-sm text-muted-foreground",children:"Pre-written Message"}),(0,b.jsx)(n.Textarea,{value:`Hey ${aa.customer?.name||"there"} â€” thanks again for letting us work on your project! Here's your invoice for ${(0,f.formatCurrency)(ag[0].amount_total)}: /i/${ag[0].public_token}. Let us know if you have any questions!`,readOnly:!0,rows:4,className:"mt-2 font-sans"}),(0,b.jsxs)(k.Button,{onClick:()=>{let a,b,c,d,e;a=aa.customer?.name||"there",c=(b=ag[0])?`/i/${b.public_token}`:"[invoice link]",d=b?(0,f.formatCurrency)(b.amount_total):"[amount]",e=`Hey ${a} â€” thanks again for letting us work on your project! Here's your invoice for ${d}: ${c}. Let us know if you have any questions!`,(0,f.copyToClipboard)(e),Y("Invoice message copied!","success"),bf(!1)},className:"w-full mt-2",children:[(0,b.jsx)(r,{className:"mr-2 h-4 w-4"}),"Copy Message"]})]})]}),"materials"===bg&&(0,b.jsx)("div",{className:"space-y-3",children:(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-sm text-muted-foreground",children:"Materials List"}),(0,b.jsx)(n.Textarea,{value:(H=aa.title,V=aa.customer?.name||"Customer",W=`Materials needed for ${H} (${V}):

`,ac.forEach((a,b)=>{let c=`${b+1}. ${a.name}`;if(a.notes&&(c+=` - ${a.notes}`),a.quantity_decimal&&a.unit){let b=a.quantity_decimal%1==0?a.quantity_decimal.toFixed(0):a.quantity_decimal;c+=` - ${b} ${a.unit}`}W+=c+`
`}),W+=`
Total items: ${ac.length}`),readOnly:!0,rows:Math.min(ac.length+4,12),className:"mt-2 font-mono text-sm"}),(0,b.jsxs)(k.Button,{onClick:()=>{b_(),bf(!1)},className:"w-full mt-2",children:[(0,b.jsx)(r,{className:"mr-2 h-4 w-4"}),"Copy List"]})]})}),"reminder"===bg&&bA&&bE&&(0,b.jsx)("div",{className:"space-y-3",children:(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{className:"text-sm text-muted-foreground",children:"Reminder Message"}),(0,b.jsx)(n.Textarea,{value:`Hey ${aa.customer?.name||"there"} â€” just a reminder that we're scheduled for ${bC&&bC!==bA?`${(0,f.formatDate)(bA)} - ${(0,f.formatDate)(bC)}`:(0,f.formatDate)(bA)} at ${(0,f.formatTime)(bE)} at ${bM||"[address]"}. Reply here if anything changes. See you then!`,readOnly:!0,rows:4,className:"mt-2 font-sans"}),(0,b.jsxs)(k.Button,{onClick:()=>{let a,b,c,d;a=aa.customer?.name||"there",b=bA?bC&&bC!==bA?`${(0,f.formatDate)(bA)} - ${(0,f.formatDate)(bC)}`:(0,f.formatDate)(bA):"[date]",c=bE?(0,f.formatTime)(bE):"[time]",d=`Hey ${a} â€” just a reminder that we're scheduled for ${b} at ${c} at ${bM||"[address]"}. Reply here if anything changes. See you then!`,(0,f.copyToClipboard)(d),Y("Reminder message copied!","success"),bf(!1)},className:"w-full mt-2",children:[(0,b.jsx)(r,{className:"mr-2 h-4 w-4"}),"Copy Message"]})]})})]})]})})]})}a.s(["JobDetailView",()=>V],39495)}];

//# sourceMappingURL=apps_matte_src_components_app_jobs_job-detail-view_tsx_e8628e64._.js.map