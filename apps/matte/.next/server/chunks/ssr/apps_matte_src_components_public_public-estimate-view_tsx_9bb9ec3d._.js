module.exports=[39513,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(59193);var d=a.i(63561),e=a.i(39177),f=a.i(22174),g=a.i(85158),h=a.i(65853),i=a.i(50838),j=a.i(96792),k=a.i(87085),l=a.i(16201),m=a.i(24987),n=a.i(46842),o=a.i(60680),p=a.i(22243),q=a.i(63374);function r({estimate:a,token:d,onSignoffComplete:g,companyLogo:h,companyName:j}){let[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(!1),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(null),B=a.line_items.map(a=>{let b=[a.name];return a.description&&b.push(a.description),b.join(" - ")}),C=a.materials?.map(a=>{let b=[];return a.paint_product&&b.push(a.paint_product),a.product_line&&b.push(a.product_line),a.color_name&&b.push(a.color_name),a.color_code&&b.push(`(${a.color_code})`),a.sheen&&b.push(`- ${a.sheen}`),a.quantity_gallons&&b.push(`${a.quantity_gallons} gal`),b.join(" ")})||[],D=Array.from(new Set(a.materials?.map(a=>a.area_description).filter(a=>a)||[])),E=l.trim()&&n&&r&&t&&v;async function F(a){if(a.preventDefault(),!E)return void A("Please complete all required fields and acknowledgments");y(!0),A(null);try{let a=await fetch(`/api/estimates/${d}/signoff`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_name:l,acknowledged_scope:n,acknowledged_materials:r,acknowledged_areas:t,acknowledged_terms:v})}),b=await a.json();if(!a.ok)throw Error(b.error||"Failed to submit signoff");g()}catch(a){A(a instanceof Error?a.message:"An error occurred")}finally{y(!1)}}return(0,b.jsxs)("div",{className:"space-y-6",children:[(h||j)&&(0,b.jsxs)("div",{className:"flex items-center gap-3 pb-4 border-b",children:[h?(0,b.jsx)("img",{src:h,alt:j||"Company Logo",className:"w-10 h-10 rounded-lg object-cover"}):(0,b.jsx)("div",{className:"w-10 h-10 rounded-lg bg-stone-800 flex items-center justify-center",children:(0,b.jsx)(k.Paintbrush,{className:"w-5 h-5 text-white"})}),j&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-bold",children:j}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Customer Agreement"})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:"Customer Agreement Required"}),(0,b.jsx)(f.CardDescription,{children:"Please review the following details and provide your acknowledgment before proceeding."})]}),(0,b.jsxs)(f.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h3",{className:"font-semibold text-lg",children:"Scope of Work"}),(0,b.jsx)("div",{className:"bg-muted p-3 rounded-lg space-y-1",children:B.length>0?B.map((a,c)=>(0,b.jsxs)("div",{className:"text-sm",children:["• ",a]},c)):(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No scope items specified"})})]}),C.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h3",{className:"font-semibold text-lg",children:"Paint Products & Materials"}),(0,b.jsx)("div",{className:"bg-muted p-3 rounded-lg space-y-1",children:C.map((a,c)=>(0,b.jsxs)("div",{className:"text-sm",children:["• ",a]},c))})]}),D.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h3",{className:"font-semibold text-lg",children:"Areas Included"}),(0,b.jsx)("div",{className:"bg-muted p-3 rounded-lg",children:(0,b.jsx)("p",{className:"text-sm",children:D.join(", ")})})]}),(0,b.jsxs)("form",{onSubmit:F,className:"space-y-4 pt-4 border-t",children:[(0,b.jsx)("h3",{className:"font-semibold text-lg",children:"Acknowledgments"}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,b.jsx)(p.Checkbox,{id:"ack-scope",checked:n,onChange:a=>o(a.target.checked)}),(0,b.jsx)(i.Label,{htmlFor:"ack-scope",className:"text-sm leading-tight cursor-pointer",children:"I acknowledge and agree to the scope of work as described above"})]}),(0,b.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,b.jsx)(p.Checkbox,{id:"ack-materials",checked:r,onChange:a=>s(a.target.checked)}),(0,b.jsx)(i.Label,{htmlFor:"ack-materials",className:"text-sm leading-tight cursor-pointer",children:"I acknowledge the paint products and materials that will be used"})]}),(0,b.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,b.jsx)(p.Checkbox,{id:"ack-areas",checked:t,onChange:a=>u(a.target.checked)}),(0,b.jsx)(i.Label,{htmlFor:"ack-areas",className:"text-sm leading-tight cursor-pointer",children:"I acknowledge the areas to be painted as specified"})]}),(0,b.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,b.jsx)(p.Checkbox,{id:"ack-terms",checked:v,onChange:a=>w(a.target.checked)}),(0,b.jsx)(i.Label,{htmlFor:"ack-terms",className:"text-sm leading-tight cursor-pointer",children:"I understand that this agreement is binding and agree to the terms of this estimate"})]})]}),(0,b.jsxs)("div",{className:"space-y-2 pt-2",children:[(0,b.jsx)(i.Label,{htmlFor:"customer-name",children:"Your Full Name *"}),(0,b.jsx)(q.Input,{id:"customer-name",type:"text",placeholder:"Enter your full name",value:l,onChange:a=>m(a.target.value),required:!0})]}),z&&(0,b.jsx)("div",{className:"rounded-lg border border-destructive bg-destructive/10 p-3",children:(0,b.jsx)("p",{className:"text-sm text-destructive",children:z})}),(0,b.jsx)(e.Button,{type:"submit",className:"w-full",disabled:!E||x,children:x?"Submitting...":"Submit Agreement"})]})]})]}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground text-center",children:"By submitting this agreement, you confirm that you have reviewed and agreed to all the details above. Your IP address and timestamp will be recorded for verification purposes."})]})}function s({estimate:a,token:p}){let[q,s]=(0,c.useState)(a),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)("accepted"===q.status),[z,A]=(0,c.useState)("denied"===q.status),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)(q.requires_signoff&&!q.signoff_completed_at),L=q.labor_total||q.line_items.reduce((a,b)=>a+b.price,0),M=q.job?[q.job.address1,q.job.city,q.job.state,q.job.zip].filter(Boolean).join(", "):"";async function N(){u(!0),C(""),E(!1);try{let a=await fetch(`/api/estimates/${p}/accept`,{method:"POST"});if(!a.ok){let b=await a.json();throw Error(b.error||"Failed to accept estimate")}y(!0),s(a=>({...a,status:"accepted",accepted_at:new Date().toISOString()}))}catch(a){C(a instanceof Error?a.message:"Something went wrong")}finally{u(!1)}}async function O(){w(!0),C(""),G(!1);try{let a=await fetch(`/api/estimates/${p}/deny`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:H||null})});if(!a.ok){let b=await a.json();throw Error(b.error||"Failed to deny estimate")}A(!0),s(a=>({...a,status:"denied",denied_at:new Date().toISOString(),denial_reason:H||null}))}catch(a){C(a instanceof Error?a.message:"Something went wrong")}finally{w(!1)}}return x?(0,b.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-stone-100 via-stone-50 to-white flex items-center justify-center p-4 relative",children:[(0,b.jsx)(o.PaintChipAnimator,{}),(0,b.jsx)(f.Card,{className:"w-full max-w-md text-center relative z-20",children:(0,b.jsxs)(f.CardContent,{className:"pt-8 pb-8",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-full bg-success/10 flex items-center justify-center mx-auto mb-4",children:(0,b.jsx)(l.CheckCircle,{className:"w-8 h-8 text-success"})}),(0,b.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Estimate Accepted!"}),(0,b.jsxs)("p",{className:"text-muted-foreground mb-6",children:["Thank you for accepting this estimate. ",q.company?.name," will be in touch soon to schedule your project."]}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Accepted on ",(0,d.formatDate)(q.accepted_at||new Date().toISOString())]})]})})]}):z?(0,b.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-stone-100 via-stone-50 to-white flex items-center justify-center p-4 relative",children:[(0,b.jsx)(o.PaintChipAnimator,{}),(0,b.jsx)(f.Card,{className:"w-full max-w-md text-center relative z-20",children:(0,b.jsxs)(f.CardContent,{className:"pt-8 pb-8",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-full bg-orange-100 flex items-center justify-center mx-auto mb-4",children:(0,b.jsx)("svg",{className:"w-8 h-8 text-orange-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,b.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Estimate Declined"}),(0,b.jsxs)("p",{className:"text-muted-foreground mb-4",children:["Thank you for your response. ",q.company?.name," has been notified of your decision."]}),q.denial_reason&&(0,b.jsxs)("div",{className:"text-sm text-left bg-muted p-3 rounded-lg mb-4",children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"Your feedback:"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:q.denial_reason})]}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Declined on ",(0,d.formatDate)(q.denied_at||new Date().toISOString())]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-4",children:[q.company?.name," may follow up with a revised estimate."]})]})})]}):(0,b.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-stone-100 via-stone-50 to-white relative",children:[(0,b.jsx)("header",{className:"border-b bg-card/80 backdrop-blur-sm sticky top-0 z-10",children:(0,b.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-4 flex items-center gap-3",children:[q.company?.logo_url?(0,b.jsx)("img",{src:q.company.logo_url,alt:q.company?.name||"Company Logo",className:"w-10 h-10 rounded-lg object-cover"}):(0,b.jsx)("div",{className:"w-8 h-8 rounded-lg bg-stone-800 flex items-center justify-center",children:(0,b.jsx)(k.Paintbrush,{className:"w-5 h-5 text-white"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-bold",children:q.company?.name}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Estimate"})]})]})}),(0,b.jsxs)("main",{className:"max-w-2xl mx-auto p-4 py-8 space-y-6",children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(f.CardTitle,{className:"text-xl",children:["Estimate for ",q.customer?.name||"Your Project"]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Created ",(0,d.formatDate)(q.created_at)]})]}),(0,b.jsx)(g.Badge,{variant:"secondary",children:q.status})]})}),(0,b.jsxs)(f.CardContent,{className:"space-y-4",children:[q.customer&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(n.User,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{children:q.customer.name})]}),M&&(0,b.jsxs)("div",{className:"flex items-start gap-2 text-sm",children:[(0,b.jsx)(m.MapPin,{className:"h-4 w-4 text-muted-foreground shrink-0 mt-0.5"}),(0,b.jsx)("span",{children:M})]})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{children:"Estimate Details"})}),(0,b.jsx)(f.CardContent,{className:"p-0",children:(0,b.jsx)("div",{className:"divide-y",children:q.line_items.map(a=>{let c=a.product_line||a.paint_color_name_or_code||a.sheen||a.gallons_estimate,e=q.materials?.filter(b=>b.estimate_line_item_id===a.id||b.area_description?.toLowerCase().includes(a.name?.toLowerCase())||a.name?.toLowerCase().includes(b.area_description?.toLowerCase()||""))||[];return(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,b.jsx)("p",{className:"font-medium",children:a.name}),a.sqft&&(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:[a.sqft," sqft",a.rate_per_sqft&&` @ ${(0,d.formatCurrency)(a.rate_per_sqft)}/sqft`]})]}),a.description&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:a.description})]}),(0,b.jsx)("p",{className:"font-medium ml-4 shrink-0",children:(0,d.formatCurrency)(a.price)})]}),e.length>0&&(0,b.jsx)("div",{className:"ml-0 mt-3 space-y-2 border-l-2 border-muted pl-3",children:e.map(a=>(0,b.jsx)("div",{className:"text-sm",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,b.jsxs)("div",{className:"flex-1 text-muted-foreground",children:[a.paint_product&&(0,b.jsxs)("div",{className:"font-medium text-foreground",children:[a.paint_product,a.product_line&&` ${a.product_line}`]}),!a.paint_product&&(0,b.jsx)("div",{className:"font-medium text-foreground",children:a.name}),(0,b.jsxs)("div",{children:[a.color_name&&(0,b.jsx)("span",{children:a.color_name}),a.color_code&&(0,b.jsxs)("span",{className:"ml-1 text-xs",children:["(",a.color_code,")"]}),a.sheen&&(0,b.jsxs)("span",{className:"ml-1",children:["- ",a.sheen]})]})]}),a.quantity_gallons&&(0,b.jsxs)("span",{className:"text-xs text-muted-foreground shrink-0",children:[a.quantity_gallons," ",1===a.quantity_gallons?"gallon":"gallons"]})]})},a.id))}),0===e.length&&c&&(0,b.jsxs)("div",{className:"text-sm text-muted-foreground mt-2 space-y-0.5",children:[(a.product_line||a.paint_color_name_or_code||a.sheen)&&(0,b.jsxs)("div",{children:[a.product_line&&(0,b.jsxs)("span",{children:[a.product_line," "]}),a.paint_color_name_or_code&&(0,b.jsxs)("span",{children:[a.paint_color_name_or_code," "]}),a.sheen&&(0,b.jsxs)("span",{children:["- ",a.sheen]})]}),a.gallons_estimate&&(0,b.jsxs)("div",{children:[a.gallons_estimate," gallons"]})]})]},a.id)})})})]}),(0,b.jsx)(f.Card,{children:(0,b.jsx)(f.CardContent,{className:"p-6 pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between text-xl font-bold",children:[(0,b.jsx)("span",{children:"Total"}),(0,b.jsx)("span",{children:(0,d.formatCurrency)(L)})]})})}),J?(0,b.jsx)(r,{estimate:q,token:p,onSignoffComplete:function(){K(!1),s(a=>({...a,signoff_completed_at:new Date().toISOString()}))},companyLogo:q.company?.logo_url,companyName:q.company?.name}):(0,b.jsxs)("div",{className:"space-y-3",children:[B&&(0,b.jsx)("p",{className:"text-sm text-destructive text-center",children:B}),(0,b.jsxs)("div",{className:"flex flex-col-reverse sm:grid sm:grid-cols-2 gap-3",children:[(0,b.jsx)(e.Button,{size:"lg",variant:"outline",className:"w-full",onClick:()=>G(!0),children:"Decline"}),(0,b.jsx)(e.Button,{size:"lg",className:"w-full",onClick:()=>E(!0),children:"Accept Estimate"})]}),(0,b.jsxs)("p",{className:"text-xs text-center text-muted-foreground",children:["Review the ",(0,d.formatCurrency)(L)," estimate above and choose to accept or decline."]})]}),(q.company?.contact_phone||q.company?.contact_email)&&(0,b.jsxs)("div",{className:"mt-8 pt-6 border-t text-center text-sm text-muted-foreground space-y-1",children:[(0,b.jsx)("p",{className:"font-medium text-foreground",children:q.company?.name}),q.company?.contact_phone&&(0,b.jsx)("p",{children:q.company.contact_phone}),q.company?.contact_email&&(0,b.jsx)("p",{children:q.company.contact_email})]})]}),(0,b.jsx)(j.Dialog,{open:D,onOpenChange:E,children:(0,b.jsxs)(j.DialogContent,{children:[(0,b.jsxs)(j.DialogHeader,{children:[(0,b.jsx)(j.DialogTitle,{children:"Accept This Estimate?"}),(0,b.jsxs)(j.DialogDescription,{children:["By accepting this ",(0,d.formatCurrency)(L)," estimate, you agree to proceed with the project.",q.company?.name," will contact you to schedule the work."]})]}),(0,b.jsxs)(j.DialogFooter,{children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>E(!1),children:"Cancel"}),(0,b.jsx)(e.Button,{onClick:N,loading:t,children:"Yes, Accept Estimate"})]})]})}),(0,b.jsx)(j.Dialog,{open:F,onOpenChange:G,children:(0,b.jsxs)(j.DialogContent,{children:[(0,b.jsxs)(j.DialogHeader,{children:[(0,b.jsx)(j.DialogTitle,{children:"Decline This Estimate?"}),(0,b.jsxs)(j.DialogDescription,{children:["Let ",q.company?.name," know why you're declining. They may be able to adjust the estimate to better meet your needs."]})]}),(0,b.jsx)("div",{className:"space-y-4 py-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"reason",children:"Reason for declining (optional)"}),(0,b.jsx)(h.Textarea,{id:"reason",placeholder:"e.g., Price is too high, timeline doesn't work, found another contractor...",value:H,onChange:a=>I(a.target.value),rows:4}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Your feedback helps ",q.company?.name," provide better service."]})]})}),(0,b.jsxs)(j.DialogFooter,{children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>{G(!1),I("")},children:"Cancel"}),(0,b.jsx)(e.Button,{variant:"destructive",onClick:O,loading:v,children:"Decline Estimate"})]})]})}),!x&&!z&&(0,b.jsx)(o.PaintChipAnimator,{})]})}a.s(["PublicEstimateView",()=>s],39513)}];

//# sourceMappingURL=apps_matte_src_components_public_public-estimate-view_tsx_9bb9ec3d._.js.map