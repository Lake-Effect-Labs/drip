module.exports=[18578,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(52517),e=a.i(39177),f=a.i(63374),g=a.i(50838),h=a.i(48351),i=a.i(85158),j=a.i(87004),k=a.i(96792),l=a.i(20170),m=a.i(65853),n=a.i(15618),o=a.i(83497),p=a.i(70106);let q=(0,p.default)("shopping-cart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);var r=a.i(99464),s=a.i(81560),t=a.i(16201),u=a.i(41961);let v=(0,p.default)("store",[["path",{d:"M15 21v-5a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v5",key:"slp6dd"}],["path",{d:"M17.774 10.31a1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.451 0 1.12 1.12 0 0 0-1.548 0 2.5 2.5 0 0 1-3.452 0 1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.77-3.248l2.889-4.184A2 2 0 0 1 7 2h10a2 2 0 0 1 1.653.873l2.895 4.192a2.5 2.5 0 0 1-3.774 3.244",key:"o0xfot"}],["path",{d:"M4 10.95V19a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8.05",key:"wn3emo"}]]),w=["each","gal","box","roll","pack","can","tube"],x=[{value:"paint",label:"Paint"},{value:"primer",label:"Primer"},{value:"sundries",label:"Sundries"},{value:"tools",label:"Tools"}];function y({initialItems:a,pickupLocations:p,companyId:r,jobMaterials:s}){let[t,y]=(0,c.useState)(a),[B,C]=(0,c.useState)(s),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(null),{addToast:H}=(0,l.useToast)(),I=(0,d.createClient)();(0,c.useEffect)(()=>{async function a(){let{data:a}=await I.from("job_materials").select(`
          *,
          job:jobs!inner(
            id,
            title,
            status,
            company_id
          )
        `).eq("job.company_id",r).in("job.status",["new","quoted","scheduled","in_progress"]).is("purchased_at",null);a&&C(a)}let b=I.channel(`inventory-job-materials-${r}`).on("postgres_changes",{event:"*",schema:"public",table:"job_materials"},()=>{a()}).on("postgres_changes",{event:"*",schema:"public",table:"jobs",filter:`company_id=eq.${r}`},()=>{a()}).subscribe();return()=>{I.removeChannel(b)}},[r,I]);let[J,K]=(0,c.useState)(""),[L,M]=(0,c.useState)("sundries"),[N,O]=(0,c.useState)("each"),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)(""),[T,U]=(0,c.useState)(""),[V,W]=(0,c.useState)("Sherwin-Williams"),[X,Y]=(0,c.useState)(""),[Z,$]=(0,c.useState)(""),[_,aa]=(0,c.useState)(!1),ab=(0,c.useMemo)(()=>{let a=new Map;B.forEach(b=>{let c=b.inventory_item_id||`unlinked_${b.name.toLowerCase()}`,d=a.get(c),e=b.quantity_decimal||0;if(d)d.totalNeeded+=e,d.jobIds.push(b.job.id),d.jobTitles.push(b.job.title),d.jobMaterialIds.push(b.id);else{let d=b.inventory_item_id?t.find(a=>a.id===b.inventory_item_id):null,f=d?.on_hand||0,g=d?.preferred_pickup_location_id||null,h=d?.pickup_location?.name||null;a.set(c,{inventoryItemId:b.inventory_item_id,name:b.name,totalNeeded:e,unit:b.unit||d?.unit||"each",storeId:g,storeName:h,onHand:f,quantityStillNeeded:Math.max(e-f,0),jobIds:[b.job.id],jobTitles:[b.job.title],jobMaterialIds:[b.id]})}}),Array.from(a.values()).forEach(a=>{a.quantityStillNeeded=Math.max(a.totalNeeded-a.onHand,0)});let b=Array.from(a.values()).filter(a=>a.quantityStillNeeded>0),c={"No Store":[]};return b.forEach(a=>{let b=a.storeName||"No Store";c[b]||(c[b]=[]),c[b].push(a)}),c},[B,t]),ac=(0,c.useMemo)(()=>Object.values(ab).flat().filter(a=>!a.inventoryItemId),[ab]);function ad(){K(""),M("sundries"),O("each"),Q(""),S(""),U(""),W("Sherwin-Williams"),Y(""),$(""),G(null)}function ae(){ad(),E(!0)}async function af(a){if(a.preventDefault(),J.trim()){aa(!0);try{let a={company_id:r,name:J.trim(),category:L,unit:N,on_hand:parseInt(P)||0,reorder_at:parseInt(R)||0,cost_per_unit:T?parseFloat(T):null,vendor_name:V||null,vendor_sku:X||null,preferred_pickup_location_id:null,notes:Z||null};if(F){let{data:b,error:c}=await I.from("inventory_items").update(a).eq("id",F.id).select("*").single();if(c)throw c;let d=p.find(a=>a.id===b.preferred_pickup_location_id)||null,e={...b,pickup_location:d};y(a=>a.map(a=>a.id===F.id?e:a)),H("Item updated!","success")}else{let{data:b,error:c}=await I.from("inventory_items").insert(a).select("*").single();if(c)throw c;let d=p.find(a=>a.id===b.preferred_pickup_location_id)||null,e={...b,pickup_location:d};y(a=>[...a,e].sort((a,b)=>a.name.localeCompare(b.name))),H("Item added!","success")}E(!1),ad()}catch(a){console.error("Error saving item:",a),H("Failed to save item","error")}finally{aa(!1)}}}async function ag(a){if(!confirm("Delete this item?"))return;let{error:b}=await I.from("inventory_items").delete().eq("id",a);b?H("Failed to delete item","error"):(y(b=>b.filter(b=>b.id!==a)),H("Item deleted","success"))}async function ah(a,b){let{error:c}=await I.from("inventory_items").update({on_hand:b}).eq("id",a);c?H("Failed to update quantity","error"):y(c=>c.map(c=>c.id===a?{...c,on_hand:b}:c))}async function ai(a,b,c){try{let{error:d}=await I.from("job_materials").update({purchased_at:new Date().toISOString()}).in("id",a);if(d)throw d;if(b){let a=t.find(a=>a.id===b);if(a){let d=a.on_hand+c;await ah(b,d)}}C(b=>b.filter(b=>!a.includes(b.id))),H("Marked as purchased!","success")}catch(a){console.error("Error marking as purchased:",a),H("Failed to mark as purchased","error")}}let aj=Object.values(ab).flat().length;return(0,b.jsxs)("div",{className:"flex h-full flex-col",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-4 border-b bg-card p-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold",children:"Inventory"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[t.length," item",1!==t.length?"s":""," •"," ",aj," needed for jobs"]})]}),(0,b.jsxs)(e.Button,{onClick:ae,children:[(0,b.jsx)(n.Plus,{className:"mr-2 h-4 w-4"}),"Add Item"]})]}),(0,b.jsx)("div",{className:"flex-1 overflow-auto p-4",children:(0,b.jsxs)(j.Tabs,{defaultValue:"all",className:"w-full",children:[(0,b.jsxs)(j.TabsList,{children:[(0,b.jsxs)(j.TabsTrigger,{value:"all",children:["All Items (",t.length,")"]}),(0,b.jsxs)(j.TabsTrigger,{value:"needed",children:[(0,b.jsx)(u.Briefcase,{className:"mr-1.5 h-3.5 w-3.5"}),"Needed for Jobs (",aj,")"]}),(0,b.jsxs)(j.TabsTrigger,{value:"buy",children:[(0,b.jsx)(q,{className:"mr-1.5 h-3.5 w-3.5"}),"Buy List (",ac.length,")"]}),(0,b.jsxs)(j.TabsTrigger,{value:"stores",children:[(0,b.jsx)(v,{className:"mr-1.5 h-3.5 w-3.5"}),"Stores (",p.length,")"]})]}),(0,b.jsx)(j.TabsContent,{value:"all",className:"mt-4",children:0===t.length?(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-8 text-center",children:[(0,b.jsx)(o.Package,{className:"mx-auto h-8 w-8 text-muted-foreground mb-2"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"No inventory items yet"}),(0,b.jsx)(e.Button,{onClick:ae,className:"mt-4",children:"Add your first item"})]}):(0,b.jsx)("div",{className:"rounded-lg border bg-card divide-y",children:t.map(a=>(0,b.jsx)(z,{item:a,onEdit:()=>{G(a),K(a.name),M(a.category),O(a.unit),Q(a.on_hand.toString()),S(a.reorder_at.toString()),U(a.cost_per_unit?.toString()||""),W(a.vendor_name||"Sherwin-Williams"),Y(a.vendor_sku||""),$(a.notes||""),E(!0)},onDelete:()=>ag(a.id),onUpdateQuantity:b=>ah(a.id,b)},a.id))})}),(0,b.jsx)(j.TabsContent,{value:"needed",className:"mt-4",children:0===aj?(0,b.jsx)("div",{className:"rounded-lg border bg-card p-8 text-center",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"No materials needed for active jobs!"})}):(0,b.jsx)("div",{className:"space-y-6",children:Object.entries(ab).map(([a,c])=>c.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-muted-foreground mb-2",children:a}),(0,b.jsx)("div",{className:"rounded-lg border bg-card divide-y",children:c.map(a=>(0,b.jsx)(A,{need:a,onMarkAsPurchased:b=>ai(a.jobMaterialIds,a.inventoryItemId,b)},a.inventoryItemId||a.name))})]},a))})}),(0,b.jsx)(j.TabsContent,{value:"buy",className:"mt-4",children:0===ac.length?(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-8 text-center",children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Nothing to buy!"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"All materials needed for jobs are already in your inventory."})]}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"rounded-lg border bg-card divide-y",children:ac.map((a,c)=>(0,b.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.name}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Need ",a.quantityStillNeeded.toFixed(2)," ",a.unit]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["For ",a.jobTitles.length," job",1!==a.jobTitles.length?"s":"",": ",a.jobTitles.join(", ")]}),a.storeName&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Store: ",a.storeName]})]}),(0,b.jsxs)(i.Badge,{variant:"warning",children:[a.quantityStillNeeded.toFixed(2)," ",a.unit]})]},a.inventoryItemId||a.name||c))}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"These items are needed for jobs but aren't in your inventory. Add them to your inventory or purchase them directly."})]})}),(0,b.jsx)(j.TabsContent,{value:"stores",className:"mt-4",children:0===p.length?(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-8 text-center",children:[(0,b.jsx)(v,{className:"mx-auto h-8 w-8 text-muted-foreground mb-2"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"No pickup locations configured yet"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"Add stores or pickup locations in Settings to track where you purchase materials."})]}):(0,b.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:p.map(a=>{let c=t.filter(b=>b.preferred_pickup_location_id===a.id);return(0,b.jsxs)("div",{className:"rounded-lg border bg-card p-4",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold",children:a.name}),a.address1&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[a.address1,a.city&&`, ${a.city}`,a.state&&`, ${a.state}`]})]}),(0,b.jsx)(i.Badge,{variant:"default",children:c.length})]}),a.notes&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:a.notes}),c.length>0&&(0,b.jsxs)("div",{className:"mt-3 pt-3 border-t",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Items from this store:"}),(0,b.jsxs)("div",{className:"space-y-1",children:[c.slice(0,5).map(a=>(0,b.jsxs)("p",{className:"text-xs truncate",children:["• ",a.name]},a.id)),c.length>5&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+",c.length-5," more"]})]})]})]},a.id)})})})]})}),(0,b.jsx)(k.Dialog,{open:D,onOpenChange:E,children:(0,b.jsxs)(k.DialogContent,{children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:F?"Edit Item":"Add Inventory Item"}),(0,b.jsx)(k.DialogDescription,{children:"Track supplies to know when you need to restock."})]}),(0,b.jsxs)("form",{onSubmit:af,className:"space-y-4 mt-4",children:[(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-2 sm:col-span-2",children:[(0,b.jsx)(g.Label,{htmlFor:"name",children:"Item Name *"}),(0,b.jsx)(f.Input,{id:"name",placeholder:"e.g., Painter's Tape 2in",value:J,onChange:a=>K(a.target.value),required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"category",children:"Category"}),(0,b.jsx)(h.Select,{id:"category",value:L,onChange:a=>M(a.target.value),children:x.map(a=>(0,b.jsx)("option",{value:a.value,children:a.label},a.value))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"unit",children:"Unit"}),(0,b.jsx)(h.Select,{id:"unit",value:N,onChange:a=>O(a.target.value),children:w.map(a=>(0,b.jsx)("option",{value:a,children:a},a))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"onHand",children:"On Hand"}),(0,b.jsx)(f.Input,{id:"onHand",type:"number",min:"0",value:P,onChange:a=>Q(a.target.value),placeholder:"0"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"reorderAt",children:"Reorder At"}),(0,b.jsx)(f.Input,{id:"reorderAt",type:"number",min:"0",value:R,onChange:a=>S(a.target.value),placeholder:"5"})]}),(0,b.jsxs)("div",{className:"space-y-2 sm:col-span-2",children:[(0,b.jsx)(g.Label,{htmlFor:"costPerUnit",children:"Cost per Unit ($)"}),(0,b.jsx)(f.Input,{id:"costPerUnit",type:"number",step:"0.01",min:"0",value:T,onChange:a=>U(a.target.value),placeholder:"0.00"})]})]}),(0,b.jsx)("hr",{}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h4",{className:"text-sm font-medium",children:"Vendor Info (optional)"}),(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"vendorName",children:"Vendor"}),(0,b.jsx)(f.Input,{id:"vendorName",value:V,onChange:a=>W(a.target.value),placeholder:"Sherwin-Williams"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"vendorSku",children:"SKU"}),(0,b.jsx)(f.Input,{id:"vendorSku",value:X,onChange:a=>Y(a.target.value),placeholder:"SW-12345"})]}),(0,b.jsxs)("div",{className:"space-y-2 sm:col-span-2",children:[(0,b.jsx)(g.Label,{htmlFor:"notes",children:"Notes"}),(0,b.jsx)(m.Textarea,{id:"notes",value:Z,onChange:a=>$(a.target.value),placeholder:"Optional notes about this item",rows:2})]})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,b.jsx)(e.Button,{type:"button",variant:"outline",onClick:()=>E(!1),children:"Cancel"}),(0,b.jsx)(e.Button,{type:"submit",loading:_,children:F?"Save Changes":"Add Item"})]})]})]})})]})}function z({item:a,onEdit:c,onDelete:d,onUpdateQuantity:f,showWarning:g}){let h=a.on_hand<=a.reorder_at;return(0,b.jsxs)("div",{className:"p-4 flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("p",{className:"font-medium truncate",children:a.name}),h&&g&&(0,b.jsx)(i.Badge,{variant:"warning",className:"shrink-0",children:"Low"}),(0,b.jsx)(i.Badge,{variant:"default",className:"shrink-0 text-xs",children:a.category})]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.on_hand," ",a.unit," on hand",a.reorder_at>0&&` • Reorder at ${a.reorder_at}`]}),a.vendor_sku&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["SKU: ",a.vendor_sku]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(e.Button,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>f(Math.max(0,a.on_hand-1)),children:"-"}),(0,b.jsx)("span",{className:"w-8 text-center text-sm font-medium",children:a.on_hand}),(0,b.jsx)(e.Button,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>f(a.on_hand+1),children:"+"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:c,children:(0,b.jsx)(r.Pencil,{className:"h-4 w-4"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:d,children:(0,b.jsx)(s.Trash2,{className:"h-4 w-4"})})]})]})}function A({need:a,onMarkAsPurchased:c}){return(0,b.jsxs)("div",{className:"p-4 flex items-start gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("p",{className:"font-medium",children:a.name}),!a.inventoryItemId&&(0,b.jsx)(i.Badge,{variant:"default",className:"shrink-0 text-xs",children:"Not Linked"})]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Total needed: ",a.totalNeeded.toFixed(2)," ",a.unit," • ","On hand: ",a.onHand," ",a.unit," • ","Still need: ",a.quantityStillNeeded.toFixed(2)," ",a.unit]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["For ",a.jobTitles.length," job",1!==a.jobTitles.length?"s":"",": ",a.jobTitles.join(", ")]})]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>c(a.quantityStillNeeded),children:[(0,b.jsx)(t.CheckCircle,{className:"mr-2 h-4 w-4"}),"Mark as Purchased"]})]})}a.s(["InventoryView",()=>y],18578)}];

//# sourceMappingURL=apps_matte_src_components_app_inventory_inventory-view_tsx_0769bf5b._.js.map