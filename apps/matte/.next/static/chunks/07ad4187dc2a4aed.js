(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,524,e=>{"use strict";var t=e.i(43476),s=e.i(71645);e.i(87467);var a=e.i(55654);let r=s.forwardRef(({className:e,error:s,children:r,...i},l)=>(0,t.jsxs)("div",{className:"relative w-full",children:[(0,t.jsx)("select",{className:(0,a.cn)("flex h-9 w-full appearance-none rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s&&"border-destructive focus-visible:ring-destructive",e),ref:l,...i,children:r}),s&&(0,t.jsx)("p",{className:"mt-1 text-xs text-destructive",children:s})]}));r.displayName="Select",e.s(["Select",()=>r])},63876,e=>{"use strict";var t=e.i(43476),s=e.i(71645);e.i(87467);var a=e.i(55654);let r=s.forwardRef(({className:e,error:s,...r},i)=>(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsx)("textarea",{className:(0,a.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s&&"border-destructive focus-visible:ring-destructive",e),ref:i,...r}),s&&(0,t.jsx)("p",{className:"mt-1 text-xs text-destructive",children:s})]}));r.displayName="Textarea",e.s(["Textarea",()=>r])},34098,e=>{"use strict";var t=e.i(43476),s=e.i(71645);e.i(87467);var a=e.i(55654);let r=s.forwardRef(({className:e,type:s,error:r,...i},l)=>(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsx)("input",{type:s,className:(0,a.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",r&&"border-destructive focus-visible:ring-destructive",e),ref:l,...i}),r&&(0,t.jsx)("p",{className:"mt-1 text-xs text-destructive",children:r})]}));r.displayName="Input",e.s(["Input",()=>r])},40574,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(25913);e.i(87467);var r=e.i(55654),i=e.i(31278);let l=(0,a.cva)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:opacity-90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-muted hover:text-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-muted hover:text-foreground",link:"text-primary underline-offset-4 hover:underline",success:"bg-success text-success-foreground shadow-sm hover:bg-success/90"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),n=s.forwardRef(({className:e,variant:s,size:a,loading:n,children:o,disabled:d,...c},u)=>(0,t.jsxs)("button",{className:(0,r.cn)(l({variant:s,size:a,className:e})),ref:u,disabled:d||n,...c,children:[n&&(0,t.jsx)(i.Loader2,{className:"animate-spin"}),o]}));n.displayName="Button",e.s(["Button",()=>n])},25913,e=>{"use strict";var t=e.i(7670);let s=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,a=t.clsx;e.s(["cva",0,(e,t)=>r=>{var i;if((null==t?void 0:t.variants)==null)return a(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:l,defaultVariants:n}=t,o=Object.keys(l).map(e=>{let t=null==r?void 0:r[e],a=null==n?void 0:n[e];if(null===t)return null;let i=s(t)||s(a);return l[e][i]}),d=r&&Object.entries(r).reduce((e,t)=>{let[s,a]=t;return void 0===a||(e[s]=a),e},{});return a(e,o,null==t||null==(i=t.compoundVariants)?void 0:i.reduce((e,t)=>{let{class:s,className:a,...r}=t;return Object.entries(r).every(e=>{let[t,s]=e;return Array.isArray(s)?s.includes({...n,...d}[t]):({...n,...d})[t]===s})?[...e,s,a]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}])},31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},80720,e=>{"use strict";var t=e.i(43476),s=e.i(71645);e.i(87467);var a=e.i(55654);let r=s.forwardRef(({className:e,...s},r)=>(0,t.jsx)("label",{ref:r,className:(0,a.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e),...s}));r.displayName="Label",e.s(["Label",()=>r])},7003,e=>{"use strict";var t=e.i(43476),s=e.i(71645);e.i(87467);var a=e.i(55654),r=e.i(37727);let i=s.createContext(void 0);function l({children:e,open:a,onOpenChange:r}){let[l,n]=s.useState(!1);return(0,t.jsx)(i.Provider,{value:{open:a??l,setOpen:r??n},children:e})}function n({children:e,className:l}){let{open:n,setOpen:o}=function(){let e=s.useContext(i);if(!e)throw Error("useDialog must be used within a Dialog");return e}();return(s.useEffect(()=>{let e=e=>{"Escape"===e.key&&o(!1)};return n&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[n,o]),n)?(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 animate-fade-in",onClick:()=>o(!1)}),(0,t.jsxs)("div",{className:(0,a.cn)("relative z-50 w-full max-w-lg max-h-[90vh] overflow-auto rounded-lg bg-card p-4 sm:p-6 shadow-lg animate-slide-up",l),children:[(0,t.jsxs)("button",{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",onClick:()=>o(!1),children:[(0,t.jsx)(r.X,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]}),e]})]}):null}function o({className:e,...s}){return(0,t.jsx)("div",{className:(0,a.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...s})}function d({className:e,...s}){return(0,t.jsx)("h2",{className:(0,a.cn)("text-lg font-semibold leading-none tracking-tight",e),...s})}function c({className:e,...s}){return(0,t.jsx)("p",{className:(0,a.cn)("text-sm text-muted-foreground",e),...s})}function u({className:e,...s}){return(0,t.jsx)("div",{className:(0,a.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s})}e.s(["Dialog",()=>l,"DialogContent",()=>n,"DialogDescription",()=>c,"DialogFooter",()=>u,"DialogHeader",()=>o,"DialogTitle",()=>d])},32307,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(26293),r=e.i(7003),i=e.i(40574),l=e.i(34098),n=e.i(80720),o=e.i(63876),d=e.i(524),c=e.i(69481);let u=["AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"];function m({open:e,onOpenChange:m,companyId:h,teamMembers:p,onJobCreated:x,initialCustomerId:f}){let[g,v]=(0,s.useState)(!1),[b,j]=(0,s.useState)([]),[y,N]=(0,s.useState)(""),[w,C]=(0,s.useState)([]),[S,L]=(0,s.useState)(""),[k,T]=(0,s.useState)(null),[I,_]=(0,s.useState)(""),[A,D]=(0,s.useState)(""),[E,F]=(0,s.useState)(""),[O,z]=(0,s.useState)(""),[J,M]=(0,s.useState)(""),[P,R]=(0,s.useState)(""),[U,B]=(0,s.useState)(""),[K,V]=(0,s.useState)(""),[H,$]=(0,s.useState)(""),[q,W]=(0,s.useState)(""),[Y,X]=(0,s.useState)(""),[Z,G]=(0,s.useState)(!1),{addToast:Q}=(0,c.useToast)();async function ee(){try{let e=await fetch("/api/job-templates");if(!e.ok)throw Error("Failed to load templates");let t=await e.json();j(t)}catch(e){console.error("Error loading templates:",e)}}async function et(){try{let e=await fetch("/api/customers");if(!e.ok)throw Error("Failed to load customers");let t=await e.json();if(C(t),f){let e=t.find(e=>e.id===f);e&&(T(e.id),D(e.name),F(e.phone||""),z(e.email||""),M(e.address1||""),R(e.address2||""),B(e.city||""),V(e.state||""),$(e.zip||""),L(e.name))}}catch(e){console.error("Error loading customers:",e)}}(0,a.createClient)(),(0,s.useEffect)(()=>{e&&(ee(),et())},[e]),(0,s.useEffect)(()=>{if(f&&w.length>0&&!k){let e=w.find(e=>e.id===f);e&&(T(e.id),D(e.name),F(e.phone||""),z(e.email||""),M(e.address1||""),R(e.address2||""),B(e.city||""),V(e.state||""),$(e.zip||""),L(e.name))}},[f,w,k]);let es=w.filter(e=>e.name.toLowerCase().includes(S.toLowerCase())||e.phone?.toLowerCase().includes(S.toLowerCase())||e.email?.toLowerCase().includes(S.toLowerCase()));async function ea(e){e.preventDefault(),v(!0);try{let e=k;if(A.trim()&&!k){let t=await fetch("/api/customers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({company_id:h,name:A.trim(),phone:E||null,email:O||null,address1:J||null,address2:P||null,city:U||null,state:K||null,zip:H||null})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to create customer")}e=(await t.json()).id}let t=await fetch("/api/jobs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({company_id:h,customer_id:e,title:I.trim(),address1:J||null,address2:P||null,city:U||null,state:K||null,zip:H||null,notes:q||null,assigned_user_id:Y||null,status:"new"})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to create job")}let s=await t.json();y&&((await fetch(`/api/job-templates/${y}/use`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({job_id:s.id})})).ok||console.error("Failed to apply template, but job created")),x(s),_(""),D(""),F(""),z(""),M(""),R(""),B(""),V(""),$(""),W(""),X(""),N(""),T(null),L("")}catch(e){console.error("Error creating job:",e),Q("Failed to create job","error")}finally{v(!1)}}return(0,t.jsx)(r.Dialog,{open:e,onOpenChange:m,children:(0,t.jsxs)(r.DialogContent,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(r.DialogHeader,{children:[(0,t.jsx)(r.DialogTitle,{children:"New Job"}),(0,t.jsx)(r.DialogDescription,{children:'Create a new job. It will start in the "New" column.'})]}),(0,t.jsxs)("form",{onSubmit:ea,className:"space-y-4 mt-4",children:[b.length>0&&(0,t.jsxs)("div",{className:"space-y-2 rounded-lg border bg-muted/30 p-4",children:[(0,t.jsx)(n.Label,{htmlFor:"template",className:"text-sm font-medium",children:"Start from Template (Optional)"}),(0,t.jsxs)(d.Select,{id:"template",value:y,onChange:e=>N(e.target.value),className:"min-h-[44px]",children:[(0,t.jsx)("option",{value:"",children:"None - Blank Job"}),b.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name,e.description&&` - ${e.description.substring(0,40)}${e.description.length>40?"...":""}`]},e.id))]}),y&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"ℹ️ Template notes and materials will be added after creating the job"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"title",children:"Job Title *"}),(0,t.jsx)(l.Input,{id:"title",placeholder:"e.g., Johnson Exterior Repaint",value:I,onChange:e=>_(e.target.value),required:!0})]}),(0,t.jsxs)("div",{className:"space-y-3 rounded-lg border p-4",children:[(0,t.jsx)("h4",{className:"font-medium text-sm",children:"Customer"}),k?(0,t.jsxs)("div",{className:"rounded-md bg-green-50 border border-green-200 p-3",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-green-800",children:"✓ Using existing customer"}),(0,t.jsx)("p",{className:"text-xs text-green-700 mt-1",children:w.find(e=>e.id===k)?.name}),(0,t.jsx)("button",{type:"button",onClick:()=>{T(null),L(""),D(""),F(""),z(""),G(!1)},className:"text-xs text-green-700 hover:text-green-900 underline mt-2",children:"Clear and create new customer"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"customerName",children:"Customer Name *"}),(0,t.jsx)(l.Input,{id:"customerName",placeholder:"John Smith",value:A,onChange:e=>D(e.target.value),className:"min-h-[44px]",required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"customerPhone",children:"Phone"}),(0,t.jsx)(l.Input,{id:"customerPhone",type:"tel",placeholder:"(555) 123-4567",value:E,onChange:e=>F(e.target.value),className:"min-h-[44px]"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"customerEmail",children:"Email"}),(0,t.jsx)(l.Input,{id:"customerEmail",type:"email",placeholder:"john@email.com",value:O,onChange:e=>z(e.target.value),className:"min-h-[44px]"})]})]}),(0,t.jsx)("div",{className:"pt-2 border-t",children:Z?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(n.Label,{htmlFor:"customerSearch",className:"text-sm",children:"Search Existing Customer"}),(0,t.jsx)("button",{type:"button",onClick:()=>{G(!1),L("")},className:"text-xs text-muted-foreground hover:text-foreground",children:"Cancel"})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(l.Input,{id:"customerSearch",placeholder:"Type name, phone, or email...",value:S,onChange:e=>{L(e.target.value),T(null)},className:"min-h-[44px]",autoFocus:!0}),S&&es.length>0&&(0,t.jsx)("div",{className:"absolute z-50 w-full mt-1 max-h-60 overflow-auto rounded-md border bg-card shadow-lg",children:es.slice(0,10).map(e=>(0,t.jsxs)("button",{type:"button",onClick:()=>{var t;let s;return t=e.id,void((s=w.find(e=>e.id===t))&&(T(t),D(s.name),F(s.phone||""),z(s.email||""),M(s.address1||""),R(s.address2||""),B(s.city||""),V(s.state||""),$(s.zip||""),L(s.name)))},className:"w-full text-left px-4 py-3 hover:bg-muted transition-colors border-b last:border-b-0",children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e.phone&&(0,t.jsx)("span",{children:e.phone}),e.phone&&e.email&&(0,t.jsx)("span",{className:"mx-1",children:"•"}),e.email&&(0,t.jsx)("span",{children:e.email})]})]},e.id))}),S&&0===es.length&&(0,t.jsx)("div",{className:"absolute z-50 w-full mt-1 p-4 rounded-md border bg-card shadow-lg text-center text-sm text-muted-foreground",children:"No customers found"})]})]}):(0,t.jsx)("button",{type:"button",onClick:()=>G(!0),className:"text-sm text-muted-foreground hover:text-foreground underline",children:"Or search existing customers"})})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("h4",{className:"font-medium text-sm",children:"Job Address"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"address1",children:"Street Address"}),(0,t.jsx)(l.Input,{id:"address1",placeholder:"123 Main St",value:J,onChange:e=>M(e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"address2",children:"Apt, Suite, etc."}),(0,t.jsx)(l.Input,{id:"address2",placeholder:"Apt 4B",value:P,onChange:e=>R(e.target.value)})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"city",children:"City"}),(0,t.jsx)(l.Input,{id:"city",placeholder:"Austin",value:U,onChange:e=>B(e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"state",children:"State"}),(0,t.jsxs)(d.Select,{id:"state",value:K,onChange:e=>V(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Select"}),u.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"zip",children:"ZIP"}),(0,t.jsx)(l.Input,{id:"zip",placeholder:"78701",value:H,onChange:e=>$(e.target.value)})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"assignedUser",children:"Assign to"}),(0,t.jsxs)(d.Select,{id:"assignedUser",value:Y,onChange:e=>X(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Unassigned"}),p.map(e=>(0,t.jsx)("option",{value:e.id,children:e.fullName},e.id))]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"notes",children:"Notes"}),(0,t.jsx)(o.Textarea,{id:"notes",placeholder:"Any additional details...",value:q,onChange:e=>W(e.target.value),rows:3})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-end gap-3 pt-4",children:[(0,t.jsx)(i.Button,{type:"button",variant:"outline",onClick:()=>m(!1),className:"w-full sm:w-auto",children:"Cancel"}),(0,t.jsx)(i.Button,{type:"submit",loading:g,className:"w-full sm:w-auto",children:"Create Job"})]})]})]})})}e.s(["NewJobDialog",()=>m])},62483,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(18566),r=e.i(26293),i=e.i(32307);function l(){let e=(0,a.useRouter)(),l=(0,a.useSearchParams)().get("customerId"),n=(0,r.createClient)(),[o,d]=(0,s.useState)(""),[c,u]=(0,s.useState)([]),[m,h]=(0,s.useState)(!0);return((0,s.useEffect)(()=>{!async function(){let{data:{user:t}}=await n.auth.getUser();if(!t)return e.push("/app/login");let{data:s}=await n.from("company_users").select("company_id").eq("user_id",t.id).maybeSingle();if(!s)return e.push("/app");d(s.company_id);let{data:a}=await n.from("company_users").select(`
          user_id,
          user_profiles!inner (
            id,
            email,
            full_name
          )
        `).eq("company_id",s.company_id);a&&u(a.filter(e=>e.user_profiles).map(e=>({id:e.user_profiles.id,email:e.user_profiles.email||"",fullName:e.user_profiles.full_name||"Unknown"}))),h(!1)}()},[n,e]),m)?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("p",{children:"Loading..."})}):(0,t.jsx)(i.NewJobDialog,{open:!0,onOpenChange:t=>{t||e.back()},companyId:o,teamMembers:c,onJobCreated:function(t){e.push(`/app/jobs/${t.id}`)},initialCustomerId:l})}e.s(["default",()=>l])}]);