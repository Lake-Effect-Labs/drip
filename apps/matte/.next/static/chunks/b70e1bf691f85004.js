(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,7003,e=>{"use strict";var t=e.i(43476),s=e.i(71645);e.i(87467);var a=e.i(55654),r=e.i(37727);let i=s.createContext(void 0);function n({children:e,open:a,onOpenChange:r}){let[n,o]=s.useState(!1);return(0,t.jsx)(i.Provider,{value:{open:a??n,setOpen:r??o},children:e})}function o({children:e,className:n}){let{open:o,setOpen:l}=function(){let e=s.useContext(i);if(!e)throw Error("useDialog must be used within a Dialog");return e}();return(s.useEffect(()=>{let e=e=>{"Escape"===e.key&&l(!1)};return o&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[o,l]),o)?(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 animate-fade-in",onClick:()=>l(!1)}),(0,t.jsxs)("div",{className:(0,a.cn)("relative z-50 w-full max-w-lg max-h-[90vh] overflow-auto rounded-lg bg-card p-4 sm:p-6 shadow-lg animate-slide-up",n),children:[(0,t.jsxs)("button",{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",onClick:()=>l(!1),children:[(0,t.jsx)(r.X,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]}),e]})]}):null}function l({className:e,...s}){return(0,t.jsx)("div",{className:(0,a.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...s})}function d({className:e,...s}){return(0,t.jsx)("h2",{className:(0,a.cn)("text-lg font-semibold leading-none tracking-tight",e),...s})}function c({className:e,...s}){return(0,t.jsx)("p",{className:(0,a.cn)("text-sm text-muted-foreground",e),...s})}function u({className:e,...s}){return(0,t.jsx)("div",{className:(0,a.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s})}e.s(["Dialog",()=>n,"DialogContent",()=>o,"DialogDescription",()=>c,"DialogFooter",()=>u,"DialogHeader",()=>l,"DialogTitle",()=>d])},524,e=>{"use strict";var t=e.i(43476),s=e.i(71645);e.i(87467);var a=e.i(55654);let r=s.forwardRef(({className:e,error:s,children:r,...i},n)=>(0,t.jsxs)("div",{className:"relative w-full",children:[(0,t.jsx)("select",{className:(0,a.cn)("flex h-9 w-full appearance-none rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s&&"border-destructive focus-visible:ring-destructive",e),ref:n,...i,children:r}),s&&(0,t.jsx)("p",{className:"mt-1 text-xs text-destructive",children:s})]}));r.displayName="Select",e.s(["Select",()=>r])},71689,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],71689)},95613,e=>{"use strict";var t=e.i(43476),s=e.i(25913);e.i(87467);var a=e.i(55654);let r=(0,s.cva)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground shadow",success:"border-transparent bg-success text-success-foreground shadow",warning:"border-transparent bg-warning text-warning-foreground shadow",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i({className:e,variant:s,...i}){return(0,t.jsx)("div",{className:(0,a.cn)(r({variant:s}),e),...i})}e.s(["Badge",()=>i])},84614,e=>{"use strict";let t=(0,e.i(75254).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>t],84614)},40574,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(25913);e.i(87467);var r=e.i(55654),i=e.i(31278);let n=(0,a.cva)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:opacity-90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-muted hover:text-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-muted hover:text-foreground",link:"text-primary underline-offset-4 hover:underline",success:"bg-success text-success-foreground shadow-sm hover:bg-success/90"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),o=s.forwardRef(({className:e,variant:s,size:a,loading:o,children:l,disabled:d,...c},u)=>(0,t.jsxs)("button",{className:(0,r.cn)(n({variant:s,size:a,className:e})),ref:u,disabled:d||o,...c,children:[o&&(0,t.jsx)(i.Loader2,{className:"animate-spin"}),l]}));o.displayName="Button",e.s(["Button",()=>o])},25913,e=>{"use strict";var t=e.i(7670);let s=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,a=t.clsx;e.s(["cva",0,(e,t)=>r=>{var i;if((null==t?void 0:t.variants)==null)return a(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:n,defaultVariants:o}=t,l=Object.keys(n).map(e=>{let t=null==r?void 0:r[e],a=null==o?void 0:o[e];if(null===t)return null;let i=s(t)||s(a);return n[e][i]}),d=r&&Object.entries(r).reduce((e,t)=>{let[s,a]=t;return void 0===a||(e[s]=a),e},{});return a(e,l,null==t||null==(i=t.compoundVariants)?void 0:i.reduce((e,t)=>{let{class:s,className:a,...r}=t;return Object.entries(r).every(e=>{let[t,s]=e;return Array.isArray(s)?s.includes({...o,...d}[t]):({...o,...d})[t]===s})?[...e,s,a]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}])},31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},46897,e=>{"use strict";let t=(0,e.i(75254).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>t],46897)},78583,e=>{"use strict";let t=(0,e.i(75254).default)("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["FileText",()=>t],78583)},45848,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(18566),r=e.i(22016),i=e.i(26293);e.i(87467);var n=e.i(55654),o=e.i(40574),l=e.i(95613),d=e.i(524),c=e.i(7003),u=e.i(69481),m=e.i(71689),x=e.i(84614),f=e.i(46897),h=e.i(78583);let p=(0,e.i(75254).default)("banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);var v=e.i(86311);let g=[{value:"cash",label:"Cash"},{value:"check",label:"Check"},{value:"venmo",label:"Venmo"},{value:"zelle",label:"Zelle"},{value:"other",label:"Other"}];function b({invoice:e}){let b=(0,a.useRouter)(),{addToast:j}=(0,u.useToast)(),y=(0,i.createClient)(),[w,N]=(0,s.useState)(e),[k,C]=(0,s.useState)(!1),[D,_]=(0,s.useState)("cash"),[M,S]=(0,s.useState)(!1),P=`${window.location.origin}/i/${w.public_token}`,z=[w.job.address1,w.job.city,w.job.state].filter(Boolean).join(", ");async function A(){S(!0);try{let{data:e}=await y.from("invoices").select("status").eq("id",w.id).single();if(e?.status==="paid"){N(e=>({...e,status:"paid"})),C(!1),j("Invoice was already marked as paid","info"),S(!1);return}let{error:t}=await y.from("invoices").update({status:"paid",paid_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",w.id).neq("status","paid");if(t)throw t;await y.from("invoice_payments").insert({invoice_id:w.id,stripe_payment_intent_id:`manual_${D}_${Date.now()}`,amount:w.amount_total,paid_at:new Date().toISOString()}),w.job_id&&await y.from("jobs").update({status:"paid",updated_at:new Date().toISOString()}).eq("id",w.job_id),N(e=>({...e,status:"paid",paid_at:new Date().toISOString()})),C(!1),j(`Marked as paid via ${D}!`,"success")}catch{j("Failed to mark as paid","error")}finally{S(!1)}}return(0,t.jsxs)("div",{className:"min-h-screen pb-20 lg:pb-0",children:[(0,t.jsx)("div",{className:"border-b bg-card",children:(0,t.jsxs)("div",{className:"max-w-3xl mx-auto p-4",children:[(0,t.jsxs)("button",{onClick:()=>b.back(),className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground mb-4",children:[(0,t.jsx)(m.ArrowLeft,{className:"h-4 w-4"}),"Back"]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Invoice"}),(0,t.jsx)(l.Badge,{variant:"paid"===w.status?"success":"sent"===w.status?"secondary":"outline",children:w.status})]}),(0,t.jsxs)("p",{className:"text-muted-foreground mt-1",children:["Created ",(0,n.formatDate)(w.created_at)]})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:(0,t.jsxs)(o.Button,{variant:"outline",size:"sm",onClick:function(){let e=w.customer?.name||"there",t=`Hey ${e} — here's your invoice for ${(0,n.formatCurrency)(w.amount_total)}: ${P} — thank you!`,s=w.customer?.phone;s&&/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?window.location.href=`sms:${s}${/iPhone|iPad|iPod/i.test(navigator.userAgent)?"&":"?"}body=${encodeURIComponent(t)}`:((0,n.copyToClipboard)(t),j("Message copied!","success"))},children:[(0,t.jsx)(v.MessageSquare,{className:"mr-2 h-4 w-4"}),w.customer?.phone&&/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?"Text Invoice":"Copy Message"]})})]})]})}),(0,t.jsxs)("div",{className:"max-w-3xl mx-auto p-4 space-y-6",children:[(0,t.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,t.jsxs)("div",{className:"rounded-lg border bg-card p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Customer"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(x.User,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"font-medium",children:w.customer.name})]}),w.customer.phone&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:w.customer.phone}),w.customer.email&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:w.customer.email})]}),(0,t.jsxs)("div",{className:"rounded-lg border bg-card p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Job"}),(0,t.jsxs)(r.default,{href:`/app/jobs/${w.job.id}`,className:"font-medium hover:underline flex items-center gap-2",children:[(0,t.jsx)(h.FileText,{className:"h-4 w-4 text-muted-foreground"}),w.job.title]}),z&&(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-1 flex items-center gap-1",children:[(0,t.jsx)(f.MapPin,{className:"h-3 w-3"}),z]})]})]}),(0,t.jsx)("div",{className:"rounded-lg border bg-card p-6",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Amount Due"}),(0,t.jsx)("p",{className:"text-4xl font-bold",children:(0,n.formatCurrency)(w.amount_total)})]})}),(0,t.jsxs)("div",{className:"rounded-lg border bg-card p-4 space-y-4",children:[(0,t.jsx)("h3",{className:"font-semibold",children:"Payment Status"}),"paid"===w.status?(0,t.jsxs)("div",{className:"bg-success/10 text-success rounded-lg p-4 text-center",children:[(0,t.jsx)("p",{className:"font-semibold",children:"Paid"}),w.paid_at&&(0,t.jsxs)("p",{className:"text-sm",children:["on ",(0,n.formatDate)(w.paid_at)]})]}):(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Mark this invoice as paid when you receive payment."}),(0,t.jsxs)(o.Button,{onClick:()=>C(!0),children:[(0,t.jsx)(p,{className:"mr-2 h-4 w-4"}),"Mark as Paid"]})]})]})]}),(0,t.jsx)(c.Dialog,{open:k,onOpenChange:C,children:(0,t.jsxs)(c.DialogContent,{children:[(0,t.jsxs)(c.DialogHeader,{children:[(0,t.jsx)(c.DialogTitle,{children:"Mark Invoice as Paid"}),(0,t.jsxs)(c.DialogDescription,{children:["Record a manual payment for ",(0,n.formatCurrency)(w.amount_total),"."]})]}),(0,t.jsxs)("div",{className:"space-y-4 mt-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Payment Method"}),(0,t.jsx)(d.Select,{value:D,onChange:e=>_(e.target.value),children:g.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,t.jsx)(o.Button,{type:"button",variant:"outline",onClick:()=>C(!1),children:"Cancel"}),(0,t.jsxs)(o.Button,{onClick:A,loading:M,children:[(0,t.jsx)(p,{className:"mr-2 h-4 w-4"}),"Confirm Payment"]})]})]})]})})]})}e.s(["InvoiceDetailView",()=>b],45848)}]);